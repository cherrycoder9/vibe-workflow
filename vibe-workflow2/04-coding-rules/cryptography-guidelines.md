# π” μ•”νΈν™” κ°€μ΄λ“λΌμΈ: μ•μ „ν•κ³  ν¨μ¨μ μΈ μ•”νΈν™” κµ¬ν„μ„ μ„ν• μ•½μ†

**λ©ν‘:** μ΄ λ¬Έμ„λ” μ°λ¦¬ ν”„λ΅μ νΈμ—μ„ μ•”νΈν™” κ΄€λ ¨ κΈ°μ μ„ μ„ νƒν•κ³  κµ¬ν„ν•  λ•, **μΌκ΄€λκ³  κ²€μ¦λ μ•μ „ν• μ ‘κ·Ό λ°©μ‹**μ„ λ”°λ¥΄λ„λ΅ λ•κΈ° μ„ν• ν•µμ‹¬ μ§€μΉ¨μ…λ‹λ‹¤. λ¨λ“  κ°λ°μ λ° LLMμ€ μ΄ κ°€μ΄λ“λΌμΈμ„ μ™μ§€ν•κ³  μ•”νΈν™” κ΄€λ ¨ μ½”λ“ μ‘μ„± μ‹ λ°λ“μ‹ μ¤€μν•΄μ•Ό ν•©λ‹λ‹¤.

*(μ£Όμ” μ°Έκ³  μλ£: OWASP Password Storage Cheat Sheet, libsodium λ¬Έμ„, NIST μ§„ν–‰ μ¤‘μΈ ν‘μ¤€ν™” λ¬Έμ„ λ“± μµμ‹  λ³΄μ• κ¶κ³  μ‚¬ν•­)*

---

## 0. μ•”νΈν™” μ„¤κ³„μ ν•µμ‹¬ μ›μΉ™

μ•”νΈν™”λ” λ³µμ΅ν•κ² κ²Ήκ²Ήμ΄ μ“λ”λ‹¤κ³  κ°•ν•΄μ§€λ” κ²ƒμ΄ μ•„λ‹™λ‹λ‹¤. λ‹¤μ μ›μΉ™λ“¤μ„ ν•­μƒ μ—Όλ‘μ— λ‘μ„Έμ”.

1. **λ‹¨μν•¨μ΄ κ°•λ ¥ν•¨μ΄λ‹¤ (Simple β‰  Weak):** λ³µμ΅ν• μμ²΄ κµ¬μ„± λ€μ‹ , **κ²€μ¦λ ν‘μ¤€ μ•κ³ λ¦¬μ¦ ν•λ‚**λ¥Ό μ„ νƒν•κ³  μ¬λ°”λ¥΄κ² μ‚¬μ©ν•λ” λ° μ§‘μ¤‘ν•μ„Έμ”.
2. **λ©”λ¨λ¦¬-ν•λ“(Memory-Hard) KDFκ°€ λ‹µμ΄λ‹¤:** λ‹¨μ λ°λ³µ ν•΄μ‹±(μ: `sha256(sha256(...))`)μ€ GPU/ASIC κ³µκ²©μ— μ·¨μ•½ν•©λ‹λ‹¤. `Argon2id`μ™€ κ°™μ΄ λ©”λ¨λ¦¬ μ‚¬μ©λ‰μ΄ λ†’μ€ KDFλ¥Ό μ‚¬μ©ν•μ„Έμ”.
3. **μ΄μ© λ‚μ΄λ„ vs. λ³΄μ• μ΄λ“:** κ΄€λ¦¬ λ° μ΄μμ λ³µμ΅μ„±μ΄ μ‹¤μ  μ–»λ” λ³΄μ• μ΄λ“λ³΄λ‹¤ ν¬λ‹¤λ©΄, λ” λ‹¨μν•κ³  μ•μ „ν• λ‹¤λ¥Έ λ°©μ‹μ„ κ³ λ ¤ν•μ„Έμ”. (μ: λ³µμ΅ν• ν‚¤ κ΄€λ¦¬ μ²΄κ³„ λ€μ‹  HSM/Secrets Manager ν™μ©)
4. **Saltλ” κ³µκ°, Pepperλ” λΉ„λ°€:** Saltλ” μ‚¬μ©μλ³„λ΅ κ³ μ ν•κ² μƒμ„±λλ” κ³µκ°λ λλ¤ κ°’μ…λ‹λ‹¤. Pepperλ” μ„λ²„ μΈ΅μ—λ§ μ•μ „ν•κ² λ³΄κ΄€λλ” λΉ„λ°€ κ°’μΌλ΅, Saltμ™€ ν•¨κ» μ‚¬μ©ν•μ—¬ ν•΄μ‹ κ°•λ„λ¥Ό λ†’μ…λ‹λ‹¤. (μ μ¶ μ‹ μ¶”κ°€ λ°©μ–΄μ„ )
5. **Nonce/ν‚¤ μ¬μ‚¬μ©μ€ μ λ€ κΈμ§€:** AEAD(Authenticated Encryption with Associated Data) μ•”νΈν™” λ°©μ‹ μ‚¬μ© μ‹, λ™μΌν• (ν‚¤, Nonce) μμ„ **μ λ€λ΅** μ¬μ‚¬μ©ν•΄μ„λ” μ• λ©λ‹λ‹¤. μ΄λ” μ•”νΈ ν•΄λ…μ μ§μ ‘μ μΈ μ›μΈμ΄ λ©λ‹λ‹¤.

---

## 1. ν¨μ¤μ›λ“ ν•΄μ‹± / ν‚¤ μ¤νΈλ μΉ­ (Password Hashing / Key Stretching)

μ‚¬μ©μμ ν¨μ¤μ›λ“λ¥Ό μ•μ „ν•κ² μ €μ¥ν•κΈ° μ„ν• KDF(Key Derivation Function) μ„ νƒ λ° μ„¤μ •μ…λ‹λ‹¤.

| ν•­λ©                                                                                                                                                                                                               | κ¶μ¥ κ°’ / μ§€μΉ¨                                                                                                                                              |
| ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **μ£Όμ” KDF μ•κ³ λ¦¬μ¦**                                                                                                                                                                                                  | **`Argon2id`** (libsodiumμ `crypto_pwhash` ν•¨μ μ‚¬μ© κ¶μ¥)                                                                                                   |
| **`Argon2id` νλΌλ―Έν„°**                                                                                                                                                                                              | μµμ†: `iterations (t) = 2`, `memory (m) = 19 MiB (2^14.2 KiB)`, `parallelism (p) = 1` (OWASP κ¶κ³ )                                                         |
| **μ„λ²„ μ„±λ¥ ν—μ© μ‹ κ¶μ¥:** `iterations (t) = 3` μ΄μƒ, `memory (m) = 1 GiB (2^20 KiB)` κ·Όμ²κΉμ§€ μƒν–¥ μ΅°μ •. ([OWASP Password Storage Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html)) |                                                                                                                                                        |
| **Salt**                                                                                                                                                                                                         | μ‚¬μ©μλ§λ‹¤ **μµμ† 16 λ°”μ΄νΈ μ΄μƒ**μ μ•”νΈν•™μ μΌλ΅ μ•μ „ν• λλ¤ κ°’(CSPRNG)μΌλ΅ μƒμ„±. ν•΄μ‹λ ν¨μ¤μ›λ“μ™€ ν•¨κ» DBμ— μ €μ¥ (μ: `salt$argon2id$v=19$m=...,t=...,p=...$hashed_password`).                 |
| **Pepper (μ„ νƒ μ‚¬ν•­)**                                                                                                                                                                                               | **μµμ† 32 λ°”μ΄νΈ μ΄μƒ**μ μ•”νΈν•™μ μΌλ΅ μ•μ „ν• λλ¤ κ°’. μ• ν”λ¦¬μΌ€μ΄μ… μ „μ²΄μ— λ€ν•΄ ν•λ‚μ κ°’μ„ μ‚¬μ©ν•κ±°λ‚, μ£ΌκΈ°μ μΌλ΅ κµμ²΄. ν™κ²½ λ³€μ, HSM, ν΄λΌμ°λ“ Secrets Manager λ“±μ„ ν†µν•΄ μ•μ „ν•κ² λ³΄κ΄€. **μ λ€ DBμ— Saltμ™€ ν•¨κ» μ €μ¥ν•μ§€ λ§ κ²ƒ.** |
| **ν•΄μ‹± ν”„λ΅μ„Έμ¤ (Pepper μ‚¬μ© μ‹)**                                                                                                                                                                                        | 1. `derived_key = Argon2id(password, salt, params)`                                                                                                    |

2. `final_hash = HMAC-SHA256(derived_key, pepper)` (HMACμ„ μ‚¬μ©ν• μ¶”κ°€ κ°•ν™”)
   *Pepperλ¥Ό Argon2id μ…λ ¥μ μΌλ¶€λ΅ ν¬ν•¨ν•λ” λ°©μ‹λ„ μμΌλ‚, HMAC λ°©μ‹μ΄ λ” μ μ—°ν•  μ μμ.*                                                   |
   \| **ν¨μ¤μ›λ“ λΉ„κµ (κ²€μ¦)**  | **λ°λ“μ‹ Constant-Time λΉ„κµ ν•¨μ** μ‚¬μ© (μ: libsodiumμ `crypto_verify_16`, `crypto_verify_32`, `crypto_verify_64` λλ” μ–Έμ–΄λ³„ μ•μ „ λΉ„κµ ν•¨μ). λ‹¨μ λ¬Έμμ—΄ λΉ„κµ(`==`)λ” νƒ€μ΄λ° κ³µκ²©μ— μ·¨μ•½.                                                   |

*μ°¨μ„ μ±… (λ κ±°μ‹ μ‹μ¤ν… νΈν™ λ©μ  μ™Έ μ‹ κ· λ„μ… κΈμ§€):* `scrypt` (νλΌλ―Έν„° μ: `N=2^17, r=8, p=1`). `PBKDF2-HMAC-SHA256`λ” λ” μ΄μƒ κ¶μ¥λμ§€ μ•μ.

---

## 2. λ€μΉ­ν‚¤ λ°μ΄ν„° μ•”νΈν™” (Symmetric Data Encryption - AEAD λ°©μ‹ ν•„μ)

μ €μ¥ λ°μ΄ν„°(Data at Rest) λλ” μ „μ†΅ μ¤‘ λ°μ΄ν„°(Data in Transit, TLS μ™Έ μ¶”κ°€ μ•”νΈν™” ν•„μ” μ‹)λ¥Ό μ„ν• μ•”νΈν™”μ…λ‹λ‹¤. **λ°λ“μ‹ AEAD(Authenticated Encryption with Associated Data) λ¨λ“λ¥Ό μ‚¬μ©**ν•μ—¬ κΈ°λ°€μ„±κ³Ό λ¬΄κ²°μ„±/μΈμ¦μ„ ν•¨κ» λ³΄μ¥ν•΄μ•Ό ν•©λ‹λ‹¤.

### 2.1. ν¨μ¤μ›λ“ κΈ°λ° μ•”νΈν™” (Password-Based Encryption - PBE)

```text
# 1. ν‚¤ νμƒ (Password-Based Key Derivation Function)
encryption_key = Argon2id(password, salt_for_encryption, argon2_params, pepper_optional)  # μ: 256-bit (32 λ°”μ΄νΈ)

# 2. μ•”νΈν™” (AEAD μ‚¬μ©)
nonce = generate_random_nonce() # μ: 24 λ°”μ΄νΈ for XChaCha20
ciphertext, authentication_tag = XChaCha20-Poly1305_encrypt(encryption_key, nonce, plaintext_data, associated_data_optional)

# 3. μ €μ¥ ν•μ‹ (μμ‹)
stored_data_format = "xchacha20poly1305:argon2id_params:" + base64(salt) + ":" + base64(nonce) + ":" + base64(ciphertext) + ":" + base64(tag)
```

### 2.2. λ§μ¤ν„° ν‚¤ κΈ°λ° μ•”νΈν™” (Master Key Based Encryption)

```text
# 1. λ°μ΄ν„° μ•”νΈν™” ν‚¤ νμƒ (HKDF μ‚¬μ©)
DEK = HKDF-SHA256(master_key, salt_optional, info_string, output_length=32)

# 2. μ•”νΈν™” (AEAD μ‚¬μ©)
nonce = generate_random_nonce()
ciphertext, tag = XChaCha20-Poly1305_encrypt(DEK, nonce, plaintext, aad_optional)

# 3. μ €μ¥ ν•μ‹ (μμ‹)
stored_data_format = "xchacha20poly1305:hkdf_salt_if_any:" + base64(nonce) + ":" + base64(ciphertext) + ":" + base64(tag)
```

### 2.3. κ¶μ¥ AEAD μ•κ³ λ¦¬μ¦

| μƒν™© / μ°μ„ μμ„   | 1μμ„ (μ†ν”„νΈμ›¨μ–΄)            | ν•λ“μ›¨μ–΄ κ°€μ† μ‹ κ³ λ ¤ (Nonce μ¬μ‚¬μ© μ €ν•­) |
| ----------- | ---------------------- | --------------------------- |
| λ¨λ“  ν”λ«νΌ (κ¶μ¥) | **XChaCha20-Poly1305** | AES-256-GCM-SIV             |

> **κΈμ§€ (CRITICAL):**
>
> * AES-GCMμ—μ„ Nonce μ¬μ‚¬μ©
> * μμ²΄ μ•”νΈν™” λ¨λ“ μ΅°ν•© ("Roll your own crypto")

---

## 3. ν‚¤ νμƒ λ° λ„λ©”μΈ λ¶„λ¦¬ (Key Derivation and Domain Separation)

* **HKDF μ‚¬μ© κ¶μ¥**: HKDF(root\_key, salt, info, length)
* `info`μ— ν‚¤ μ©λ„λ¥Ό λ…ν™•ν•κ² ν‘μ‹ (μ: "user\_data\_v1").

---

## 4. μ•”νΈν™” κµ¬ν„ μ²΄ν¬λ¦¬μ¤νΈ β…

* [ ] Salt: 16λ°”μ΄νΈ μ΄μƒ, CSPRNG, κ³ μ  μ €μ¥
* [ ] Pepper: 32λ°”μ΄νΈ μ΄μƒ, μ•μ „ λ³΄κ΄€
* [ ] KDF νλΌλ―Έν„°: OWASP κ¶κ³  μ΄μƒ
* [ ] Nonce: (ν‚¤,Nonce) μ¬μ‚¬μ© κΈμ§€
* [ ] μΈμ¦ νƒκ·Έ κ²€μ¦ ν•„μ
* [ ] Constant-Time λΉ„κµ μ‚¬μ©
* [ ] κ²€μ¦λ λΌμ΄λΈλ¬λ¦¬λ§ μ‚¬μ©

---

## 5. ν”ν• μ•ν‹°ν¨ν„΄ π’£

| β μ•ν‹°ν¨ν„΄                     | μ΄μ                         |
| -------------------------- | ------------------------- |
| KDF μ¤‘μ²© (Argon2id ν›„ scrypt) | λ³΄μ• ν–¥μƒ λ―Έλ―Έ, μ„λ²„ λ¶€ν•λ§ μ¦κ°€       |
| μ΄μ¤‘ AEAD μ•”νΈν™”                | κ²€μ¦λμ§€ μ•μ€ λ°©μ‹, μ„±λ¥ μ €ν•         |
| PBKDF2 λλ” bcrypt μ‹ κ· λ„μ…     | GPU κ³µκ²© μ·¨μ•½, λ©”λ¨λ¦¬ ν•λ“λ‹μ¤ λ¶€μ΅±    |
| Pepperλ¥Ό DBμ— μ €μ¥             | Pepper μλ―Έ μƒμ‹¤, DB μ μ¶ μ‹ λ¬΄λ ¥ν™” |
| κ³ μ • Nonce μ‚¬μ©                | μΉλ…μ  μ·¨μ•½μ , AEAD λ³΄μ• λ¬΄λ„μ§      |
| μμ²΄ μ•”νΈν™” μ•κ³ λ¦¬μ¦ μ‚¬μ©             | κ²€μ¦λμ§€ μ•μ, μ·¨μ•½μ  μ λ°           |

---

## 6. μ•”νΈν™” μ¬λ΅κ±΄ π€

> "Keep It Simple, Secure, and Standard."

---

**LLM μ½”λ”© κ°€μ΄λ“:** μ•”νΈν™” μ½”λ“ μ‘μ„± μ‹ μ΄ κ°€μ΄λ“λ¥Ό μµμ°μ„ μΌλ΅ μ°Έκ³ ν•κ³ , κΈμ§€ ν•­λ©μ„ μ λ€ μƒμ„±ν•μ§€ λ§μ„Έμ”. μμ‹¬λλ©΄ λ” μ•μ „ν• μµμ…μ„ μ μ•ν•κ³ , κ·Όκ±°λ¥Ό μ„¤λ…ν•΄μ£Όμ„Έμ”.
