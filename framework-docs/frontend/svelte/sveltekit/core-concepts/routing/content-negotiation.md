Content negotiation
`+server.js` 파일이랑 `+page` 파일을 같은 폴더에 둘 수 있는데, 이게 뭘 의미하냐면 똑같은 주소(URL)로 요청이 들어와도 어떨 때는 웹페이지를 보여주고, 어떨 때는 API 엔드포인트로 작동하게 할 수 있다는 거야. "하나의 주소, 두 개의 얼굴" 같은 거지. 그럼 스벨트킷은 뭘 보고 이걸 결정하느냐? 다음 규칙을 따라:

*   `PUT`, `PATCH`, `DELETE`, `OPTIONS` 요청: 얘네는 페이지 보여달라는 요청이랑은 거리가 머니까 무조건 `+server.js`가 처리해. "데이터 고치거나 지우는 건 서버랑 직접 얘기하셈!" 이런 느낌.
*   `GET`, `POST`, `HEAD` 요청: 이때는 요청 헤더에 있는 `Accept` 값을 봐.
    *   `Accept` 헤더가 `text/html`을 우선으로 원하면 (즉, 브라우저가 "나 페이지 보고 싶어!" 할 때) 페이지 요청으로 보고 `+page` 쪽으로 보내.
    *   그 외의 경우 (예: "나 `application/json` 데이터 내놔!" 할 때)는 `+server.js`가 처리하는 거지.
*   `GET` 요청에 대한 응답에는 `Vary: Accept` 헤더를 포함시켜. 이렇게 해야 프록시 서버나 브라우저가 HTML 응답이랑 JSON 응답을 별개의 것으로 보고 따로따로 캐싱해서 나중에 헷갈리지 않아. "김치찌개 시켰는데 된장찌개 나오면 안 되잖아?"

---

**얘 뭐 하는 애냐?**
하나의 URL로 웹페이지도 보여주고, 순수 데이터만 뱉어주는 API 엔드포인트 역할도 동시에 수행하게 해주는 똑똑한 교통정리 기능이야. "낮에는 젠틀한 웹페이지, 밤에는 화끈한 API 엔드포인트!" 뭐 이런 거지. 클라이언트가 뭘 원하냐에 따라 알아서 다른 걸 내주는 거야.

**왜 쓰는데?**
1.  **코드 재활용 및 관리 용이**: 페이지 보여줄 때 필요한 데이터랑 API로 제공할 데이터가 비슷하거나 로직을 공유할 때 유용해. 같은 주소니까 연관된 코드가 한곳에 모여있어서 파악하기 쉽지. "이 주소 하나로 다 해결!"
2.  **유연한 API 제공**: 똑같은 `/items/123` 주소로 브라우저가 접속하면 아이템 상세 페이지를, 프로그램이 `Accept: application/json` 헤더 달고 접속하면 아이템의 JSON 데이터를 받을 수 있게 돼.
3.  **SEO와 API 동시 만족**: 검색엔진은 HTML 페이지를 긁어가고, 외부 서비스나 모바일 앱은 API로 데이터를 가져갈 수 있게 해줘.

**언제 불려 나오냐?**
클라이언트(브라우저든, 프로그램이든)가 특정 URL로 요청을 보낼 때, SvelteKit이 HTTP 메서드(GET, POST 등)랑 `Accept` 헤더를 스윽 보고 "아, 이건 페이지로 가야겠다" 또는 "이건 API로 처리해야겠군" 하고 판단해서 `+page.svelte` 또는 `+server.js` 중 하나를 깨우는 거야.

**쓸 때 꿀팁 및 주의사항:**
*   **`Accept` 헤더가 핵심 열쇠**: 브라우저는 보통 `Accept` 헤더에 `text/html`을 우선적으로 포함해서 보내니까 자연스럽게 페이지로 연결돼. API 클라이언트(curl, Postman, JavaScript `fetch` 등)를 쓸 때는 `Accept: application/json` (또는 원하는 다른 MIME 타입)을 명시적으로 보내줘야 `+server.js`가 응답한다. "요구사항을 정확히 말해야 원하는 걸 얻는다, 알겠냐?"
*   **`POST` 요청은 특히 주의**: `POST` 요청도 `Accept` 헤더에 따라 갈리는데, HTML 폼을 제출하는 경우는 보통 페이지 리다이렉션이나 HTML 응답을 기대하지만, 순수 데이터 API로 `POST`를 사용하려면 `Accept: application/json`을 확실히 해줘야 해. 안 그러면 "왜 API 응답 안 오고 페이지가 뜨지?" 하고 삽질할 수 있음.
*   **`Vary: Accept` 헤더의 중요성**: 이거 덕분에 같은 URL이라도 캐시가 꼬이는 걸 막아줘. 스벨트킷이 알아서 잘 챙겨주지만, 이게 왜 필요한지 원리를 이해하면 나중에 문제 생겼을 때 대처하기 편해. "캐시야, 눈치껏 일해라!"
*   **무조건 합치는 게 능사는 아님**: 기능이 명확히 구분되거나, API와 페이지의 로직이 완전히 딴판이라면 굳이 한 주소에 욱여넣기보다 그냥 다른 경로를 쓰는 게 더 깔끔할 수 있어. "만능 스위스 아미 나이프도 너무 복잡하면 쓰기 불편하다."
*   **`+server.js`는 `Response` 객체를 직접 반환**: `+page.js`의 `load` 함수처럼 데이터를 객체로 반환하는 게 아니라, `Response` 객체를 만들어서 반환해야 한다는 점을 잊지 마. "여긴 직접 요리해서 내보내야 하는 식당이야."