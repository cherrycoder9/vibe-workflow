**Storing state in the URL (URL에 상태 저장하기)**

페이지를 새로고침해도 유지되어야 하거나 서버 사이드 렌더링(SSR)에도 영향을 줘야 하는 상태값들 있지? 예를 들면 표에서 필터링 조건이나 정렬 규칙 같은 거. 이런 건 URL의 검색 파라미터(예: `?sort=price&order=ascending`)에 넣어두면 딱 좋아.

이런 파라미터는 `<a href="...">`나 `<form action="...">` 속성에 직접 써넣을 수도 있고, `goto('?key=value')` 같은 코드로 프로그래밍해서 설정할 수도 있어. 이렇게 설정된 값들은 `load` 함수 안에서는 `url` 파라미터를 통해, 컴포넌트 안에서는 `page.url.searchParams`를 통해 접근할 수 있지.

---

**얘 뭐 하는 애냐?**
말 그대로 웹페이지의 특정 상태(정렬 방식, 필터 조건, 현재 페이지 번호 등)를 브라우저 주소창의 URL에다가 기록해두는 기술이야. 이렇게 하면 사용자가 페이지를 새로고침하거나, 링크를 복사해서 다른 사람에게 보내거나, 북마크했다가 나중에 다시 접속해도 그 상태가 그대로 유지돼. "야, 너 저번에 보던 설정 그대로 다시 보여줄게!" 하는 거지.

**왜 쓰는데?**
1.  **상태 유지 (Persistence):** 새로고침해도 설정값 안 날아가는 게 제일 큰 장점. 사용자가 공들여 설정한 필터나 정렬이 F5 한 방에 초기화되면 빡치잖아. "내 시간 돌려내!" 소리 안 듣게 해줌.
2.  **공유 용이성:** 특정 필터나 정렬이 적용된 상태의 페이지를 다른 사람에게 URL만 복붙해서 보내줄 수 있어. 받은 사람은 링크만 클릭하면 바로 그 상태로 페이지를 볼 수 있지. "야, 이거 봐봐. 가격 오름차순으로 정렬한 건데 대박이지?"
3.  **북마크 가능:** 사용자가 원하는 상태를 북마크해뒀다가 나중에 그대로 다시 볼 수 있어.
4.  **서버 사이드 렌더링 (SSR) 지원:** URL에 상태값이 있으니 서버에서도 이 값을 읽어서 해당 상태에 맞는 초기 페이지를 렌더링해서 보내줄 수 있어. 첫 로딩 속도나 SEO에 유리하지. "서버도 니가 뭘 원하는지 알고 미리 준비한다."
5.  **브라우저 히스토리 활용:** 뒤로가기/앞으로가기 버튼 눌렀을 때 이전 상태로 자연스럽게 이동 가능.

**언제 불려 나오냐? (어떻게 쓰냐?)**
*   **`<a>` 태그:** `<a href="/items?sort=name&filter=active">이름순 정렬, 활성 항목만 보기</a>`처럼 링크에 직접 파라미터를 넣어.
*   **`<form>` 태그 (GET 방식):** `<form method="GET" action="/search"> <input name="query"> <button type="submit">검색</button> </form>` 이렇게 하면 폼 제출 시 `?query=검색어` 형태로 URL에 붙어.
*   **프로그래밍 방식 (`goto` 함수 등):** 스벨트킷의 `goto` 함수를 써서 `goto('/items?sort=price')` 이런 식으로 동적으로 URL을 변경하고 상태를 업데이트할 수 있어. 사용자가 버튼을 클릭하거나 드롭다운에서 옵션을 선택했을 때 주로 이렇게 처리하지.

**가져다 쓸 때는?**
*   **`load` 함수:** 서버나 클라이언트에서 데이터 로딩할 때 `url.searchParams.get('sort')` 이런 식으로 값을 읽어서 데이터 가져오는 데 써먹어.
*   **컴포넌트 내부:** `$page.url.searchParams.get('filter')`처럼 현재 페이지의 URL 파라미터 값을 읽어서 UI를 업데이트하거나 로직을 처리해.

**쓸 때 꿀팁 및 주의사항:**
*   **민감 정보는 절대 금지:** 비밀번호, 개인 식별 정보 같은 건 URL에 절대 넣으면 안 돼. 주소창에 다 보이고, 서버 로그에도 남고, 브라우저 히스토리에도 남아. "URL에 주민번호 적는 놈 있냐?"
*   **너무 많은 정보는 URL을 더럽힌다:** 상태값이 너무 많거나 길면 URL이 지저분해지고 길어져서 문제 생길 수 있어 (URL 길이 제한). 꼭 필요한 최소한의 정보만 넣자.
*   **값 검증은 필수:** 사용자가 URL을 직접 수정해서 이상한 값을 넣을 수도 있으니, `load` 함수나 컴포넌트에서 값 읽을 때 항상 유효성 검사해야 돼. "아무거나 막 넣는다고 다 받아주면 안 된다."
*   **URL 인코딩/디코딩:** 한글이나 특수문자는 URL에 그냥 쓰면 문제 생길 수 있으니 알아서 잘 인코딩/디코딩되는지 확인하거나, 필요하면 직접 처리해야 해. (대부분 라이브러리가 알아서 해주긴 함)
*   **기본값 설정:** 특정 파라미터가 없을 때 사용할 기본값을 정해두면 코드가 깔끔해지고 예외 처리도 쉬워. "아무것도 안 고르면 기본 세팅으로 간다."
*   **상태 관리 라이브러리와의 관계:** 간단한 상태는 URL로 충분하지만, 복잡한 앱 전체 상태는 여전히 스토어나 컨텍스트 API 같은 걸 쓰는 게 나을 수 있어. URL은 "공유 가능하고 영속적인" 상태에만 쓰는 게 좋아. "모든 짐을 URL한테만 맡기지 마라."