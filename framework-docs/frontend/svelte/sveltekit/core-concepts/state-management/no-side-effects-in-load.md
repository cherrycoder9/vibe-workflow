`load` 함수에서는 딴짓 금지!

같은 이유로, 네 `load` 함수는 순수해야 해. 딴짓거리(side-effect)는 금물이야 (가끔 `console.log(...)` 찍는 정도는 봐줄게). 예를 들어, 컴포넌트에서 값을 써먹으려고 `load` 함수 안에서 스토어나 전역 상태에 뭔가 저장하고 싶은 유혹이 들 수도 있어:

```typescript
// +page.ts
import { user } from '$lib/user';
import type { PageLoad } from './$types';

export const load: PageLoad = async ({ fetch }) => {
	const response = await fetch('/api/user');

	// 절대 이렇게 하지 마! 이따구로 짜면 망함!
	user.set(await response.json());
};
```

이전 예시처럼, 이렇게 하면 한 유저 정보가 모든 유저가 공유하는 공간에 들어가 버리는 수가 있어. 그 대신 그냥 데이터를 반환해...

```typescript
// +page.ts
import type { PageServerLoad } from './$types';

export const load: PageServerLoad = async ({ fetch }) => {
	const response = await fetch('/api/user');

	return {
		user: await response.json()
	};
};
```

...그리고 필요한 컴포넌트에 넘겨주거나 `$page.data`를 써.

만약 서버 사이드 렌더링(SSR)을 안 쓴다면, 한 유저 데이터를 다른 유저한테 실수로 노출할 위험은 없어. 그래도 `load` 함수에서 딴짓은 피하는 게 좋아. 그래야 네 애플리케이션이 훨씬 이해하기 쉬워지거든. "코드는 단순할수록 아름답다" 이 말이야.

---

**얘 뭐 하는 애냐?**
`load` 함수는 페이지 띄우기 전에 필요한 데이터를 미리 가져오는 녀석인데, 여기서 "딴짓 금지"란 이 함수가 데이터 가져오는 일 외에 다른 시스템 상태(예: 전역 스토어 값 변경)를 건드리지 말라는 규칙이야. 순수하게 데이터만 패치하고, 계산하고, 반환하라는 거지. "데이터 배달부는 배달만 해라, 옆집에 참견하지 말고!"

**왜 쓰는데?**
1.  **데이터 오염 방지 (특히 SSR 환경):** 서버에서 여러 사용자 요청을 동시에 처리할 때, `load` 함수가 전역 스토어 같은 공용 공간을 건드리면 A 사용자 데이터가 B 사용자에게 보이는 대참사(데이터 유출)가 터질 수 있어. "내 택배 상자에 왜 네 물건이 들어있냐?"
2.  **예측 가능성 UP:** `load` 함수가 순수하면, 같은 입력에 대해 항상 같은 결과를 내놓으니까 코드 흐름 파악하기가 훨씬 쉬워져. 버그 잡기도 편하고. "정직한 자판기처럼, 넣은 만큼만 나와야지, 갑자기 사이다 대신 콜라 뱉으면 곤란하잖아?"
3.  **테스트 용이성:** 외부 상태에 의존하거나 변경하지 않으니, 함수 자체만 똑 떼서 단위 테스트하기가 아주 수월해져.

**언제 불려 나오냐?**
`load` 함수는 해당 라우트(페이지)가 로드되기 직전에 스벨트킷에 의해 호출돼. 이 "딴짓 금지" 규칙은 `load` 함수를 작성할 때 항상 지켜야 하는 개발 원칙 같은 거야. "지킬 건 지키자."

**쓸 때 꿀팁 및 주의사항:**
*   **데이터는 무조건 `return`:** `load` 함수에서 가져오거나 가공한 데이터는 반드시 `return` 키워드를 사용해서 반환해야 해. 이렇게 반환된 데이터는 페이지 컴포넌트에서 `export let data;`로 받거나, `$page.data` 스토어를 통해 접근할 수 있어.
*   **전역 스토어 직접 수정은 절대 금물:** `load` 함수 안에서 `writable` 스토어의 `set`이나 `update` 메소드를 호출해서 전역 상태를 바꾸려는 시도는 "나중에 큰 버그로 돌아올 테다" 하는 예약 티켓 끊는 거나 마찬가지야. 특히 SSR 환경에서는 절대 하지 마. "하지 말라면 좀 하지 마!"
*   **`fetch`는 OK, DB 직접 쓰기는 NO (클라이언트 `load` 기준):** 클라이언트 사이드 `load` 함수 (`+page.ts` 또는 `+layout.ts`)에서는 `fetch`를 사용해서 API로부터 데이터를 가져오는 건 괜찮아. 하지만 브라우저 환경에서 직접 DB에 쓰거나 하는 등의 작업은 당연히 안 되겠지. 서버 사이드 `load` (`+page.server.js` 또는 `+layout.server.js`)에서는 DB 접근 등이 가능하지만, 여기서도 반환 값 외의 전역적인 상태 변경은 극도로 신중해야 해.
*   **`console.log`는 디버깅의 친구:** 개발 중에 `console.log`로 값 찍어보는 건 "딴짓"으로 안 쳐줘. 이건 수사에 필요한 CCTV 같은 거니까. 하지만 운영 환경에서는 정리하는 게 좋겠지.