# Progressive Enhancement and use_enhance

점진적 향상(Progressive enhancement)
이전 섹션들에서는 클라이언트 사이드 자바스크립트 없이도 작동하는 `/login` 액션을 만들었어. `fetch` 한번 안 쓰고 말이지. 아주 훌륭해. 하지만 자바스크립트가 사용 가능할 때는 폼 인터랙션을 점진적으로 향상시켜서 더 나은 사용자 경험을 제공할 수 있지.

`use:enhance`
폼을 점진적으로 향상시키는 가장 쉬운 방법은 `use:enhance` 액션을 추가하는 거야:

`src/routes/login/+page.svelte` (원문에서는 `+page`라고만 되어 있지만, Svelte 파일이므로 확장자를 명시)

```svelte
<script lang="ts">
	import { enhance } from '$app/forms';
	import type { PageData } from './$types'; // 원문은 PageProps지만, SvelteKit 최신 버전에서는 PageData가 일반적. form을 받으려면 ActionData도 고려해야 하지만, 여기서는 form을 props로 받는 상황을 가정.
	export let data: PageData; // form을 data 객체 내부의 속성으로 받는 것이 일반적. let { form } = $props()는 Rune 문법인데, 아직 실험적 기능.
</script>

<form method="POST" use:enhance>
	<!-- 폼 내용 -->
</form>
```

`use:enhance`는 `method="POST"`이고 `+page.server.js` 파일에 정의된 액션을 가리키는 폼에만 사용할 수 있어. `method="GET"` (메서드가 지정되지 않은 폼의 기본값)에서는 작동하지 않아. `method="POST"`가 아니거나 `+server.js` 엔드포인트로 전송하는 폼에 `use:enhance`를 사용하려고 하면 에러가 발생할 거야. "POST 전용이다, 이거 못 지키면 바로 에러행 특급열차 타는 거다."

맞아, `enhance` 액션이랑 `<form action>` 둘 다 '액션'이라고 불려서 좀 헷갈릴 수 있어. 이 문서들은 액션으로 가득 차 있거든. 미안. "개발 용어, 가끔은 지뢰밭이지."

인자 없이 `use:enhance`를 사용하면, 전체 페이지 새로고침 없이 브라우저 네이티브 동작을 흉내 낼 거야. 다음과 같은 일을 해:

*   성공적인 응답이나 유효하지 않은 응답 시 `form` 속성, `page.form`, `page.status`를 업데이트해. 단, 액션이 현재 제출하는 페이지와 동일한 페이지에 있을 때만 해당돼. 예를 들어, 폼이 `<form action="/다른데로">`처럼 되어 있다면, `form` 속성과 `page.form` 상태는 업데이트되지 않아. 이건 네이티브 폼 제출 시 해당 액션이 있는 페이지로 리다이렉트되기 때문이야. 만약 어떤 경우든 업데이트되길 원한다면 `applyAction`을 사용해.
*   `<form>` 요소를 리셋해.
*   성공적인 응답 시 `invalidateAll`을 사용해 모든 데이터를 무효화해.
*   리다이렉트 응답 시 `goto`를 호출해.
*   에러 발생 시 가장 가까운 `+error` 경계를 렌더링해.
*   적절한 요소로 포커스를 리셋해.

---

얘 뭐 하는 애냐?
`use:enhance`는 SvelteKit 폼(form)에 자바스크립트가 활성화된 브라우저에서 사용자 경험을 부드럽게 만들어주는 '점진적 향상' 도우미야. 기본 HTML 폼 제출은 페이지 전체가 깜빡이며 새로고침되는데, 얘는 그걸 막고 백그라운드에서 데이터를 처리하게 해줘. "새로고침 없이 폼 쓰는 거, 이거 완전 신세계 아니냐?"

왜 쓰는데?
1.  **UX 향상**: 페이지 전체 새로고침 없이 폼을 제출하고 결과를 받을 수 있어서 사용자가 훨씬 쾌적하게 느껴. 로딩 스피너 돌리거나, 성공/실패 메시지를 같은 페이지에서 바로 보여줄 수 있지.
2.  **점진적 향상**: 자바스크립트가 없거나 로딩에 실패해도 기본 HTML 폼 제출 방식으로 알아서 작동해. 즉, 핵심 기능은 보장하면서 JS 사용자에게는 더 나은 경험을 주는 거지. "JS 없어도 돌아는 간다, 이 말이야."
3.  **개발 편의성**: 복잡한 `fetch` 로직, 상태 관리, 에러 처리 등을 직접 다 짜지 않아도 SvelteKit이 알아서 상당 부분 처리해줘.

언제 불려 나오냐?
HTML `<form>` 태그에 `method="POST"` 속성이 있고, 해당 폼이 같은 라우트의 `+page.server.js`에 정의된 액션(action)을 호출할 때 `use:enhance`를 붙여서 사용해.

쓸 때 꿀팁 및 주의사항:
*   **POST 전용**: `method="GET"` 폼에는 못 써. 쓰면 에러 나니까 괜히 시도하지 마. "GET한테는 그림의 떡."
*   **`+page.server.js` 짝꿍**: 폼 액션은 반드시 `+page.server.js` 파일 안에 정의되어 있어야 해. 그냥 API 엔드포인트(`+server.js`)로 보내는 폼에는 안 먹혀.
*   **기본 동작 이해**: 인자 없이 쓰면 네이티브 폼 동작을 최대한 따라가되, 페이지 리로드는 없어. 데이터 업데이트(`form`, `page.form`), 폼 리셋, 데이터 무효화(`invalidateAll`), 리다이렉트 처리(`goto`) 등을 자동으로 해줘.
*   **커스텀 가능**: `enhance` 함수에 콜백 함수를 전달해서 제출 전, 후 또는 에러 발생 시 특정 로직을 추가할 수 있어. 예를 들어, 로딩 상태를 표시하거나, 성공/실패 시 특정 UI를 업데이트하는 등의 세밀한 제어가 가능해. "기본도 좋지만, 커스텀하면 더 강력해진다."
*   **다른 페이지 액션**: 폼이 `<form action="/다른페이지">`처럼 다른 페이지의 액션을 호출하면, 기본적으로 현재 페이지의 `form` 관련 상태는 업데이트 안 돼. 네이티브 동작 따라가는 거지. 만약 그래도 업데이트하고 싶으면 `applyAction` 함수를 써야 해.
*   **`$app/forms`에서 임포트**: `import { enhance } from '$app/forms';` 이거 까먹지 마. "기본 중의 기본이다."