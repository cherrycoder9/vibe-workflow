Hooks (훅)

'훅'은 앱 전체에서 사용되는 함수로, 특정 이벤트에 대한 응답으로 SvelteKit이 호출합니다. 이를 통해 프레임워크의 동작을 세밀하게 제어할 수 있습니다.

세 가지 훅 파일이 있으며, 모두 선택 사항입니다:

*   `src/hooks.server.js` — 앱의 서버 훅
*   `src/hooks.client.js` — 앱의 클라이언트 훅
*   `src/hooks.js` — 앱의 클라이언트 및 서버 양쪽에서 실행되는 훅

이 모듈의 코드는 애플리케이션이 시작될 때 실행되므로 데이터베이스 클라이언트 등을 초기화하는 데 유용합니다.

`config.kit.files.hooks` 설정을 통해 이 파일들의 위치를 변경할 수 있습니다.

---

**얘 뭐 하는 애냐?**

SvelteKit의 '훅'은 쉽게 말해 "SvelteKit 작동 중간중간에 끼어들어서 내 맘대로 뭔가 추가하거나 바꾸는 기능"입니다. 웹사이트 로딩, 페이지 이동, 데이터 요청 같은 핵심적인 과정에 갈고리(hook)를 걸어서 특정 시점에 내가 만든 코드를 실행시키는 거죠. "SvelteKit, 잠깐만! 이거 먼저 하고 가실게요~" 하는 느낌이랄까요.

**왜 쓰는데?**

1.  **공통 로직 처리:** 모든 페이지 또는 특정 조건에서 반복적으로 해야 하는 작업들(예: 사용자 인증 상태 확인, 레이아웃 변경, 로깅)을 한 곳에 모아 처리할 수 있습니다. "여기저기 똑같은 코드 복붙하지 말고, 훅에다 맡겨!"
2.  **요청/응답 조작:** 사용자가 페이지를 요청하거나 서버가 응답을 보내기 직전에 내용을 가로채서 수정할 수 있습니다. 헤더를 추가하거나, 데이터를 가공하거나, 특정 조건에 따라 다른 페이지로 보내버리는 등의 작업이 가능하죠. "데이터 나가기 전에 검문 한 번 합시다!"
3.  **초기화 작업:** 앱이 처음 시작될 때 데이터베이스 연결, 외부 서비스 연동, 환경 설정 같은 초기화 코드를 실행하기 좋습니다. 서버 훅은 서버 시작 시, 클라이언트 훅은 브라우저에서 앱 로드 시 실행되거든요.
4.  **에러 처리:** 앱 전역에서 발생하는 에러를 잡아서 사용자에게 친절한 에러 페이지를 보여주거나, 에러 로그를 남기는 등의 공통 에러 처리 로직을 구현할 수 있습니다.

**언제 불려 나오냐?**

훅의 종류(`server`, `client`, `universal`)와 훅 내부에서 어떤 함수(`handle`, `handleFetch`, `handleError` 등)를 쓰느냐에 따라 호출 시점이 다릅니다.

*   `handle`: 서버에서 요청을 받아서 페이지를 렌더링하기 직전에 호출됩니다. (주로 `hooks.server.js`)
*   `handleFetch`: `fetch` 요청을 보내기 직전에 호출되어 요청 자체를 수정하거나 가로챌 수 있습니다. (서버/클라이언트 양쪽)
*   `handleError`: 에러 발생 시 호출되어 에러를 어떻게 처리할지 결정합니다. (서버/클라이언트 양쪽)
*   훅 파일 자체(`hooks.server.js`, `hooks.client.js`, `hooks.js`)는 앱이 처음 시작될 때 딱 한 번 실행됩니다. (초기화용)

**쓸 때 꿀팁 및 주의사항:**

*   **파일 위치와 이름은 약속!:** 기본적으로 `src/hooks.server.js`, `src/hooks.client.js`, `src/hooks.js`라는 정해진 경로와 이름을 써야 SvelteKit이 알아서 찾아 씁니다. 물론 설정으로 바꿀 수도 있지만, 굳이?
*   **서버 훅 vs 클라이언트 훅 vs 공용 훅, 구분 잘하자:**
    *   `hooks.server.js`: 서버에서만 돌아갑니다. DB 접근, 비밀 키 사용 등 민감한 작업은 여기에!
    *   `hooks.client.js`: 브라우저에서만 돌아갑니다. `window`나 `document` 객체 접근 등 브라우저 전용 작업은 여기에!
    *   `hooks.js`: 서버랑 브라우저 양쪽에서 다 돌아갑니다. 양쪽에서 필요한 공통 로직(예: 간단한 데이터 가공)은 여기에! "아무 데나 코드 던져놓고 '왜 안돼?' 하지 말자!"
*   **`handle` 함수의 `event`와 `resolve`:** `handle` 훅을 쓸 때는 `event` 객체로 현재 요청 정보를 받고, `resolve(event)`를 호출해서 다음 단계로 요청을 넘겨줘야 합니다. `resolve` 안 하면 페이지 로딩이 멈춰버리는 대참사가! "패스 안 하고 공 계속 들고 있으면 경기 진행 안 된다고!"
*   **비동기 작업은 `async/await` 필수:** 훅 안에서 비동기 작업을 한다면 함수를 `async`로 만들고 `await`를 제대로 써줘야 합니다. 안 그러면 SvelteKit이 기다려주지 않고 다음으로 넘어가 버려서 꼬일 수 있습니다.
*   **성능 생각 좀 하고 쓰자:** 훅은 모든 요청이나 특정 중요 이벤트마다 실행될 수 있습니다. 여기에 무거운 로직을 잔뜩 넣으면 앱 전체가 느려질 수 있으니, 가볍고 빠르게 처리되도록 신경 써야 합니다. "모든 길목에 바리케이드 치면 차 막히는 거랑 똑같다."
*   **훅은 '선언'하는 것:** 훅 파일에 특정 이름의 함수(예: `export async function handle({ event, resolve })`)를 `export` 해두면 SvelteKit이 알아서 가져다 씁니다. 내가 직접 그 함수를 호출하는 게 아닙니다.