`init` 함수

이 함수는 서버가 생성되거나 브라우저에서 앱이 시작될 때 딱 한 번 실행됩니다. 데이터베이스 연결 초기화 같은 비동기 작업을 하기에 아주 유용한 곳이죠.

만약 당신의 개발 환경이 최상위 await(top-level await)를 지원한다면, `init` 함수는 사실상 모듈 최상단에 초기화 로직을 그냥 적는 것과 별 차이가 없습니다. 하지만 사파리(Safari) 같은 몇몇 환경에서는 이 기능을 지원하지 않죠. (그래서 `init`이 필요하다 이 말입니다.)

**예시: `src/hooks.server.js` 또는 `src/hooks.server.ts`**

```typescript
import * as db from '$lib/server/database';
import type { ServerInit } from '@sveltejs/kit';

export const init: ServerInit = async () => {
	await db.connect(); // 데이터베이스야, 연결 좀 하자!
};
```

브라우저 환경에서 `init` 함수 안의 비동기 작업은 하이드레이션(hydration, 서버에서 렌더링된 HTML에 자바스크립트 생명력을 불어넣는 과정)을 지연시킬 수 있습니다. 그러니 뭘 집어넣을지 신중하게 생각하세요.

---

**얘 뭐 하는 애냐?**

SvelteKit에서 `init` 함수는 애플리케이션이 처음 시작될 때, 딱 한 번 실행되는 특별한 초기화용 함수입니다. 서버에서는 서버 뜰 때, 브라우저에서는 앱이 처음 로딩될 때 호출되죠. "자, 이제 장사 시작합니다! 개업 준비!" 딱 이런 느낌입니다. 주로 앱 전체에서 사용될 설정이나 외부 서비스 연결(DB 연결, API 클라이언트 초기화 등)처럼 시작 전에 미리 해둬야 하는 작업들을 처리합니다.

**왜 쓰는데?**

1.  **비동기 초기화 작업 처리:** 앱 시작 시 필요한 비동기 작업들, 예를 들어 데이터베이스에 연결하거나, 외부 API에서 초기 데이터를 가져오는 등의 작업을 깔끔하게 처리할 수 있습니다. `async/await`을 써서 동기 코드처럼 편하게 작성 가능하죠.
2.  **환경 제약 극복:** 최상위 `await`을 지원하지 않는 구형 브라우저(특히 사파리)나 특정 Node.js 환경에서도 비동기 초기화 로직을 안정적으로 실행할 수 있게 해줍니다. "야, 너네 동네선 `await` 바로 못 쓴다며? 그럼 이걸로 해."
3.  **코드 정리:** 앱 시작과 관련된 로직을 `hooks.server.js` (서버용)나 `hooks.client.js` (클라이언트용) 파일의 `init` 함수 안에 모아둘 수 있어서 코드가 더 깔끔해집니다. "개업 준비는 여기서 다 한다!"

**언제 불려 나오냐?**

*   **서버 사이드:** SvelteKit 개발 서버가 시작되거나, 빌드된 앱이 프로덕션 서버에서 처음 실행될 때 `src/hooks.server.js` (또는 `.ts`) 파일에 정의된 `init` 함수가 호출됩니다.
*   **클라이언트 사이드:** 사용자가 브라우저에서 SvelteKit 앱에 처음 접속하여 자바스크립트가 로드되고 실행될 때 `src/hooks.client.js` (또는 `.ts`) 파일에 정의된 `init` 함수가 호출됩니다.

**쓸 때 꿀팁 및 주의사항:**

*   **하이드레이션 지연 주의 (클라이언트):** 브라우저용 `init` 함수(`src/hooks.client.js`)에서 시간이 오래 걸리는 비동기 작업을 하면, 그 작업이 끝날 때까지 하이드레이션이 멈춥니다. 즉, 사용자는 서버에서 그려준 깡통 HTML만 보고 버튼 클릭 같은 상호작용을 못 하는 시간이 길어질 수 있다는 거죠. "손님, 아직 오픈 준비 중입니다. 잠시만 기다려주세요... (너무 길면 손님 다 떠남)" 그러니 클라이언트 `init`에는 진짜 최소한의, 필수적인 작업만 넣는 게 좋습니다.
*   **서버 `init`은 비교적 자유:** 서버 `init`은 서버 시작 시 한 번만 실행되므로, 클라이언트만큼 하이드레이션 지연을 걱정할 필요는 없습니다. 그래도 너무 오래 걸리면 서버 시작 자체가 느려지니 적당히 해야겠죠.
*   **최상위 `await`과 비교:** 요즘 대부분의 모던 자바스크립트 환경(Node.js 최신 버전 등)은 모듈 최상단에서 `await`을 바로 쓸 수 있습니다. 이런 환경이라면 `init` 함수를 굳이 안 쓰고 그냥 `hooks.server.js` 파일 맨 위에 `await db.connect();` 이렇게 적어도 똑같이 동작합니다. `init`은 이런 기능을 지원하지 않는 환경과의 호환성을 위한 배려인 셈이죠. "굳이? 싶으면 안 써도 되는데, 보험 삼아 쓰는 거지."
*   **에러 처리 확실하게:** `init`에서 에러 나면 앱 시작부터 꼬이는 겁니다. `try...catch` 등으로 예외 처리를 꼼꼼하게 해서, 문제가 생겼을 때 로그를 남기거나 적절히 대응하도록 만들어야 합니다. "개업 첫날부터 망할 순 없잖아?"
*   **파일 위치 정확히:** 서버용 초기화는 `src/hooks.server.js` (또는 `.ts`), 클라이언트용 초기화는 `src/hooks.client.js` (또는 `.ts`)에 작성해야 SvelteKit이 제대로 인식합니다. 엉뚱한 데 적어놓고 "왜 안돼?" 하지 마세요.