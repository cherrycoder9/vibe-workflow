**매칭 (Matching)**

`src/routes/fruits/[page]` 같은 라우트는 `/fruits/apple`에도 맞지만, `/fruits/rocketship` 같은 엉뚱한 주소에도 맞아버립니다. 이런 건 우리가 원하는 게 아니죠. 라우트 파라미터가 제대로 된 형식인지 확인하려면 `params` 디렉토리에 **매처(matcher)**를 추가하면 됩니다. 매처는 파라미터 문자열("apple" 또는 "rocketship")을 받아서 유효하면 `true`를 반환하는 함수입니다.

**`src/params/fruit.ts` (또는 `.js`)**

```typescript
import type { ParamMatcher } from '@sveltejs/kit';

export const match = ((param: string): param is ('apple' | 'orange') => {
	return param === 'apple' || param === 'orange';
}) satisfies ParamMatcher;
```

그리고 이렇게 라우트에 적용합니다:

**`src/routes/fruits/[page=fruit]/+page.svelte`**

만약 경로명이 매처 조건에 안 맞으면, SvelteKit은 다른 라우트들을 (아래 명시된 정렬 순서에 따라) 시도해보고, 그래도 없으면 결국 404 에러를 뱉습니다.

`params` 디렉토리의 각 모듈은 하나의 매처에 해당합니다. 단, `*.test.js`나 `*.spec.js` 파일은 매처 유닛 테스트용으로 사용될 수 있으니 예외입니다.

매처는 서버랑 브라우저 양쪽에서 다 돌아갑니다.

---

**얘 뭐 하는 애냐?**

SvelteKit의 **매처(Matcher)**는 라우트 경로에 들어오는 동적 파라미터(URL의 일부가 바뀌는 부분, 예를 들어 `/fruits/apple`에서 `apple` 부분)가 우리가 정한 특정 규칙에 맞는지 검사하는 "문지기" 같은 녀석입니다. 아무거나 다 통과시키는 게 아니라, "너 사과 아니면 오렌지만 들어올 수 있어!"처럼 까다롭게 구는 거죠. 이렇게 하면 엉뚱한 URL로 접근하는 걸 막고, 좀 더 깔끔하고 예측 가능한 라우팅 구조를 만들 수 있습니다.

**왜 쓰는데?**

1.  **유효성 검사 (Validation):** `/user/[id]` 같은 라우트에서 `id`가 숫자만 와야 한다거나, `/post/[slug]`에서 `slug`가 특정 형식(예: 소문자, 숫자, 하이픈만 가능)이어야 할 때 씁니다. "아무거나 막 넣지 말라고! 형식 좀 지켜!"
2.  **라우트 명확성 향상:** `/items/[category]`에서 `category`가 `electronics`, `books`, `clothing` 중 하나여야 한다면, 매처로 이걸 강제해서 다른 이상한 `category` 값으로 접근하는 걸 막을 수 있습니다. 이렇게 하면 어떤 URL이 유효한지 개발자도 명확히 알 수 있고, 사용자에게도 엉뚱한 페이지를 보여줄 가능성이 줄어듭니다.
3.  **타입스크립트와의 시너지:** 매처 함수에서 타입 가드(예: `param is ('apple' | 'orange')`)를 사용하면, 해당 라우트 컴포넌트 안에서 파라미터 타입을 더 정확하게 추론할 수 있어서 개발 편의성이 올라갑니다. "타입까지 딱 맞으니 코딩이 편해지네!"

**언제 불려 나오냐?**

*   사용자가 브라우저 주소창에 URL을 입력하거나, 앱 내부에서 링크를 클릭해서 특정 라우트로 이동하려고 할 때, 해당 라우트에 매처가 설정되어 있다면 SvelteKit 라우터가 가장 먼저 이 매처를 실행합니다.
*   매처 함수는 URL에서 추출된 파라미터 값을 인자로 받아서 `true` 또는 `false`를 반환합니다.
*   `true`를 반환하면 "통과! 이 라우트가 맞습니다." 하고 해당 페이지를 보여줍니다.
*   `false`를 반환하면 "넌 안돼! 이 규칙에 안 맞아." 하면서 SvelteKit은 다른 매칭되는 라우트가 있는지 찾아보거나, 없으면 404 페이지를 보여줍니다.

**쓸 때 꿀팁 및 주의사항:**

*   **파일 위치와 이름이 중요:** 매처는 `src/params` 폴더 안에 만들어야 하고, 파일 이름(확장자 제외)이 곧 매처의 이름이 됩니다. 예를 들어 `src/params/fruit.ts` 파일은 `fruit`라는 이름의 매처가 되는 거죠. 그리고 라우트 파일에서는 `[paramName=matcherName]` 형태로 사용합니다.
*   **서버/클라이언트 양쪽 실행:** 매처는 서버에서 페이지를 처음 렌더링할 때도 실행되고, 클라이언트에서 페이지 이동할 때도 실행됩니다. 따라서 브라우저 전용 API나 Node.js 전용 API를 매처 안에서 함부로 쓰면 한쪽에서 에러 날 수 있으니 조심해야 합니다. "양쪽 다 생각하고 코드 짜라고!"
*   **정규식 활용의 좋은 예:** 복잡한 문자열 패턴을 검사해야 한다면 정규표현식이 아주 유용합니다. 예를 들어, 숫자만 허용하려면 `/^\d+$/.test(param)` 같은 코드를 쓸 수 있겠죠.
*   **너무 복잡한 로직은 피하기:** 매처는 라우팅의 첫 관문입니다. 여기서 너무 무거운 작업을 하거나 외부 API를 호출하는 등의 로직을 넣으면 페이지 로딩 속도에 영향을 줄 수 있습니다. 가볍고 빠르게 실행될 수 있는 검증 로직 위주로 구성하는 게 좋습니다. "문지기가 너무 오래 붙잡고 있으면 손님들 다 도망간다!"
*   **테스트는 필수:** `*.test.js` 또는 `*.spec.js` 파일을 이용해서 매처 로직이 의도대로 잘 돌아가는지 유닛 테스트를 작성하는 것이 좋습니다. "믿는 도끼에 발등 찍히기 전에 테스트부터 해!"