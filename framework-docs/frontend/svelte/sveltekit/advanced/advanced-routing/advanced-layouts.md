**고급 레이아웃 (Advanced layouts)**

원래 SvelteKit에서 레이아웃은 주소(route) 따라 중첩되는 게 국룰입니다. 근데 가끔은 그게 영 마음에 안 들 때가 있죠.

**(그룹) 폴더**

앱 내부 페이지(`/dashboard`, `/item` 등)는 A 레이아웃을 쓰고, 마케팅 페이지(`/about`, `/testimonials` 등)는 B 레이아웃을 쓰고 싶다고 칩시다. 이럴 때 폴더 이름 양옆에 괄호를 쳐서 `(app)`, `(marketing)`처럼 그룹으로 묶어버릴 수 있습니다. 일반 폴더랑 다르게, 이 괄호 폴더들은 URL 주소에는 전혀 영향을 안 줍니다. 그냥 레이아웃만 따로 먹이는 용도죠.

```
src/routes/
│ (app)/            // '/app' 경로가 생기는 게 아님!
│ ├ dashboard/
│ ├ item/
│ └ +layout.svelte  // (app) 그룹 전용 레이아웃
│ (marketing)/      // '/marketing' 경로도 물론 안 생김!
│ ├ about/
│ ├ testimonials/
│ └ +layout.svelte  // (marketing) 그룹 전용 레이아웃
├ admin/
└ +layout.svelte      // 최상위 레이아웃
```

괄호 폴더 바로 밑에 `+page.svelte`를 둬서, 예를 들어 홈페이지(`/`)를 `(app)`이나 `(marketing)` 그룹의 페이지로 만들 수도 있습니다.

**레이아웃 탈출하기**

최상위 레이아웃(`src/routes/+layout.svelte`)은 앱 모든 페이지에 적용됩니다. 만약 빼먹으면 그냥 `{@render children()}` (내용물만 냅다 보여주는 기본값)으로 돌아가고요. 특정 페이지만 나머지랑 다른 레이아웃 계층을 갖게 하고 싶다면? 앱 전체를 하나 이상의 그룹으로 묶어버리고, 그 공통 레이아웃을 상속받지 않아야 할 놈들만 그룹 밖에 빼놓으면 됩니다.

위 예시에서 `/admin` 경로는 `(app)`이나 `(marketing)` 레이아웃을 전혀 상속받지 않습니다. 걔는 혼자 노는 거죠.

**`+page@` (특정 페이지만 레이아웃 갈아타기)**

페이지마다 현재 레이아웃 계층에서 "나 여기서 빠져나갈래!" 하고 선언할 수 있습니다. 아까 그 `(app)` 그룹 안에 `/item/[id]/embed`라는 경로가 있다고 칩시다.

```
src/routes/
├ (app)/
│ ├ item/
│ │ ├ [id]/
│ │ │ ├ embed/
│ │ │ │ └ +page.svelte       // 이놈!
│ │ │ └ +layout.svelte     // item/[id] 레이아웃
│ │ └ +layout.svelte       // item 레이아웃
│ └ +layout.svelte         // (app) 레이아웃
└ +layout.svelte             // 최상위 레이아웃
```

원래대로라면 이 `embed` 페이지는 최상위 레이아웃, `(app)` 레이아웃, `item` 레이아웃, `[id]` 레이아웃까지 줄줄이 다 상속받습니다. 하지만 파일 이름 뒤에 `@`랑 특정 폴더(세그먼트) 이름을 붙이면, 그 폴더의 레이아웃으로 바로 점프해서 상속받을 수 있습니다. 최상위 레이아웃으로 가고 싶으면 `@` 뒤에 아무것도 안 쓰면 됩니다.

예를 들어, `embed` 페이지를 이렇게 바꿀 수 있다는 거죠.

*   `+page@[id].svelte`: `src/routes/(app)/item/[id]/+layout.svelte` 부터 상속 (바로 위 부모)
*   `+page@item.svelte`: `src/routes/(app)/item/+layout.svelte` 부터 상속 (두 단계 위 부모)
*   `+page@(app).svelte`: `src/routes/(app)/+layout.svelte` 부터 상속 ((app) 그룹 레이아웃)
*   `+page@.svelte`: `src/routes/+layout.svelte` 부터 상속 (최상위 레이아웃, 싹 다 무시)

그래서 이렇게 파일을 만들면,

```
src/routes/
├ (app)/
│ ├ item/
│ │ ├ [id]/
│ │ │ ├ embed/
│ │ │ │ └ +page@(app).svelte  // (app) 레이아웃부터 다시 시작!
// ... (나머지 구조는 동일)
```

`embed` 페이지는 `item`이나 `[id]` 레이아웃은 건너뛰고 `(app)` 레이아웃을 바로 입게 됩니다.

**`+layout@` (특정 레이아웃부터 판 새로 짜기)**

페이지뿐만 아니라 레이아웃 파일 자체도 부모 레이아웃 계층에서 탈출할 수 있습니다. 똑같은 `@` 문법을 쓰면 됩니다. 예를 들어, `+layout@.svelte` 파일을 만들면, 그 레이아웃과 그 밑의 모든 자식 경로는 최상위 레이아웃부터 다시 시작하게 됩니다. 중간 레이아웃들은 싹 다 무시되는 거죠.

```
src/routes/
├ (app)/
│ ├ item/
│ │ ├ [id]/
│ │ │ ├ embed/
│ │ │ │ └ +page.svelte       // (app)/item/[id]/+layout.svelte 사용
│ │ │ ├ +layout.svelte       // (app)/item/+layout@.svelte 상속
│ │ │ └ +page.svelte         // (app)/item/+layout@.svelte 사용
│ │ └ +layout@.svelte        // (app)/+layout.svelte 건너뛰고 최상위 레이아웃 상속!
│ └ +layout.svelte
└ +layout.svelte
```

**언제 레이아웃 그룹을 써야 할까?**

모든 경우에 이 괄호 폴더 그룹핑이 답은 아닙니다. 굳이 억지로 쓸 필요도 없고요. 괜히 썼다가 괄호 폴더만 주렁주렁 열려서 구조만 복잡해지거나, 딸랑 하나 예외 처리하자고 괄호 폴더 도입하는 건 좀 그렇죠. 그럴 땐 그냥 재사용 가능한 로드 함수나 Svelte 컴포넌트를 쓰거나, `{#if}` 문으로 처리하는 게 훨씬 깔끔할 수 있습니다. "과유불급! 뇌절 금지!"

아래 예시는 레이아웃이 최상위 레이아웃으로 "되감기"하고, 다른 레이아웃에서도 쓸 수 있는 공용 컴포넌트와 함수를 재활용하는 모습입니다.

`src/routes/nested/route/+layout@.svelte` (최상위 레이아웃으로 리셋)

```svelte
<script lang="ts">
	import ReusableLayout from '$lib/ReusableLayout.svelte';
	let { data, children } = $props();
</script>

<ReusableLayout {data}>
	{@render children()}
</ReusableLayout>
```

`src/routes/nested/route/+layout.svelte` (이건 `@` 없는 일반 레이아웃, 위 `@` 파일이 없다면 이걸 썼겠죠)

```typescript
import { reusableLoad } from '$lib/reusable-load-function';
import type { PageLoad } from './$types';

export const load: PageLoad = (event) => {
	// 필요하면 추가 로직 넣고
	return reusableLoad(event); // 공용 로드 함수 호출
};
```

---

**얘 뭐 하는 애냐?**

SvelteKit의 "고급 레이아웃" 기능들은 기본적으로 주소(URL) 따라 줄줄이 사탕처럼 이어지는 레이아웃 상속 구조에서 벗어나, 좀 더 유연하고 복잡한 레이아웃 전략을 짤 수 있게 해주는 도구 모음입니다. 쉽게 말해, "우리 집은 원래 3대가 같이 사는데, 내 방만 독립해서 원룸처럼 꾸밀래!" 또는 "이쪽 동네 사람들은 A 스타일 옷 입고, 저쪽 동네 사람들은 B 스타일 옷 입히자!" 같은 걸 가능하게 해주는 거죠.

**왜 쓰는데?**

1.  **URL은 깔끔하게, 레이아웃은 다양하게:** `/app/dashboard`랑 `/company/about`처럼 URL 구조는 다른데, 사실상 같은 레이아웃 그룹(예: '내부용', '외부용')으로 묶고 싶을 때 `(group)` 폴더를 씁니다. URL에 `(group)` 이름이 안 들어가니 개이득이죠.
2.  **특정 페이지만 예외 처리:** "이 페이지만 헤더/푸터 없이 깡통으로 보여줘!" (예: `/print-page`, `/embed-content`) 또는 "이 페이지만 완전히 다른 레이아웃을 입혀줘!" 할 때 `+page@`를 씁니다. 상속 다 끊고 원하는 레이아웃으로 갈아타는 거죠.
3.  **특정 구간부터 레이아웃 리셋:** "여기서부터는 앞의 레이아웃 다 무시하고 새 출발이다!" 특정 하위 경로 전체에 대해 레이아웃 판을 새로 짜고 싶을 때 `+layout@`를 씁니다.
4.  **결론: 유지보수 편하게, 구조는 명확하게.** 복잡한 앱일수록 이런 기능 없이 레이아웃 관리하려면 `{#if}` 덕지덕지 바르거나 컴포넌트에서 쌩쑈를 해야 하는데, 이걸 쓰면 파일/폴더 구조만으로 의도를 명확히 표현할 수 있습니다. (물론 너무 꼬면 그것도 지옥행)

**언제 불려 나오냐? (사용 시점)**

개발자가 `src/routes` 폴더 안에 특정 규칙에 맞춰 폴더(예: `(app)`)나 파일(예: `+page@(app).svelte`)을 만들 때 이 기능들이 "작동 대기" 상태가 됩니다. 그리고 사용자가 해당 경로로 접속하면, SvelteKit이 이 파일 구조와 명명 규칙을 해석해서 "아, 이 페이지는 이 레이아웃을 입히고, 저 레이아웃은 건너뛰어야겠군!" 하고 최종 레이아웃을 결정해서 화면에 뿌려줍니다. 즉, 빌드 시점과 런타임에 걸쳐 작동하는 셈이죠.

**쓸 때 꿀팁 및 주의사항:**

*   **괄호 `(group)` 폴더:** URL에 흔적도 안 남기고 레이아웃만 그룹핑하니 꿀입니다. 단, 너무 중첩시키면 "여기가... 어디죠...?" 하면서 길 잃기 딱 좋습니다. "폴더 구조로 미로 만들지 마라."
*   **`@` 문법 (탈출!):**
    *   `+page@.svelte` 또는 `+layout@.svelte` (뒤에 아무것도 없음): "다 필요 없고, 맨 처음부터 시작!" (최상위 `+layout.svelte`로 리셋)
    *   `+page@(groupName).svelte`: "저기 `(groupName)` 폴더에 있는 `+layout.svelte` 입혀줘!"
    *   이거 남발하면 레이아웃 흐름 추적하다가 뇌가 꼬일 수 있습니다. "이 페이지 레이아웃 왜 이럼?" 디버깅하다 현타 올 수 있으니, 꼭 필요할 때만 명확한 의도로 쓰세요. "이거 완전 레이아웃계의 핵폭탄 버튼."
*   **대안을 잊지 마:** 문서에서도 말했지만, 모든 걸 이걸로 해결하려 들지 마세요. 간단한 건 그냥 컴포넌트 안에서 `{#if}` 쓰거나, 공용 컴포넌트/함수 만들어서 쓰는 게 훨씬 직관적일 수 있습니다. "망치 들었다고 모든 걸 못으로 보지 말자."
*   **구조는 곧 문서다:** 폴더와 파일 이름이 곧 레이아웃 설계도가 됩니다. 혼자 개발해도 나중에 본인이 헷갈리고, 팀 작업이면 더더욱 명확하고 예측 가능하게 짜야 합니다. "나만 아는 예술적인 폴더 구조는 그냥 자기만족일 뿐."
*   **성능?**: 대부분 파일 시스템 기반이라 빌드 시점에 많이 결정되지만, 너무 복잡한 구조는 초기 로딩이나 페이지 전환 시 미미하게나마 영향을 줄 수도 있습니다. (근데 거의 체감 안 될 수준)