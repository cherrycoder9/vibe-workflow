**Caveats (주의사항/알아둬야 할 점)**

서버 사이드 렌더링(SSR) 할 때는 `page.state`가 항상 빈 객체야. 사용자가 처음 딱 접속하는 페이지에서도 마찬가지지. 만약 사용자가 페이지를 새로고침하거나 다른 문서 갔다가 돌아오면, `state`는 사용자가 다른 페이지로 이동하기 전까지는 적용되지 않아. "서버는 니가 뭘 하려는지 모르니까 일단 빈손으로 시작한다, 이 말이야."

얕은 라우팅(Shallow routing)은 자바스크립트가 있어야만 돌아가는 기능이야. 이거 쓸 때는 항상 염두에 두고, 만약 자바스크립트가 동작 안 하는 환경일 경우 어떻게 대처할지 (fallback behavior) 미리 고민해두는 게 좋아. "자바스크립트 없으면 그냥 바보 되는 기능이니까, 플랜 B는 필수다."

---

**얘 뭐 하는 애냐?**
`Caveats`는 특정 기능을 사용할 때 "이런 점은 알고 써라, 안 그러면 뒤통수 맞는다!" 하고 미리 경고해주는 내용들이야. 특히 SvelteKit의 `page.state`와 얕은 라우팅(Shallow routing) 쓸 때 정신 똑바로 차리라는 거지.

**왜 이런 게 있는데?**
1.  **SSR의 한계 명시:** 서버는 클라이언트(브라우저)처럼 사용자의 모든 상태를 실시간으로 알 수 없어. 그래서 `page.state`처럼 클라이언트 쪽 상태를 SSR 시점에는 빈 값으로 줄 수밖에 없다는 걸 알려주는 거야. "서버는 점쟁이가 아니다."
2.  **초기 로딩 시 `page.state` 동작 방식 안내:** 사용자가 처음 페이지에 딱 들어왔을 때나 새로고침했을 때, `page.state`가 바로 채워지지 않는다는 걸 명확히 해서 "왜 안 되지?" 하는 삽질을 막아줘.
3.  **자바스크립트 의존성 경고 (얕은 라우팅):** 얕은 라우팅은 URL은 바꾸지만 페이지 전체를 새로 로드하지 않고 일부만 쓱 바꾸는 기술인데, 이게 순전히 자바스크립트 빨로 돌아가. 그래서 자바스크립트 꺼진 환경에서는 "앙꼬 없는 찐빵" 신세라는 걸 알려주는 거지. "자바스크립트 없으면? 응, 안 돼~"

**언제 신경 써야 하냐?**
*   `page.state`를 서버 사이드 렌더링 결과물에 뭔가 반영하려고 할 때. (안되니까 기대하지 마)
*   사용자가 페이지에 처음 진입하거나 새로고침했을 때 `page.state` 값을 바로 쓰려고 할 때. (안되니까 다른 방법 찾아봐)
*   얕은 라우팅을 핵심 기능으로 사용해서 페이지 이동이나 데이터 로딩을 처리하려고 할 때. (자바스크립트 안 되면 어쩔 건데? 대책 세워놔)

**쓸 때 꿀팁 및 주의사항:**
*   **SSR과 `page.state`는 상극:** 서버에서 렌더링할 때는 `page.state`에 뭔가 있을 거라는 기대는 버려. 만약 초기 상태가 필요하면 `load` 함수나 다른 방식을 써야 해.
*   **첫 방문/새로고침 시 `page.state`는 없다 생각해:** 사용자가 페이지와 상호작용(예: 다른 내부 링크 클릭)을 시작해야 `page.state`가 의미를 가지기 시작해. 그전에는 그냥 빈 통이야.
*   **얕은 라우팅은 점진적 향상(Progressive Enhancement) 관점에서:** 핵심 기능은 자바스크립트 없이도 동작하게 만들고, 얕은 라우팅은 "있으면 더 좋은" 부가 기능으로 생각하는 게 안전빵이야. 예를 들어, 얕은 라우팅으로 모달을 띄우더라도, 자바스크립트가 없으면 그냥 해당 상세 페이지로 이동하게끔 만들어야지. "최소한 기본은 해야 욕 안 먹는다."
*   **`<a>` 태그의 `href`는 기본 중의 기본:** 얕은 라우팅을 위해 `<a>` 태그에 `onclick` 이벤트로 별짓을 다 하더라도, `href` 속성에는 정상적인 URL을 꼭 넣어줘. 그래야 자바스크립트가 맛이 가거나, 사용자가 마우스 휠 클릭, 새 탭으로 열기 등을 했을 때도 정상적으로 페이지 이동이 돼. "기본도 안 지키면 유저들한테 쌍욕 먹는다."
*   **상태 복원은 너의 몫:** `page.state`는 브라우저의 `history.state`를 쓰는 건데, 이게 모든 상황에서 완벽하게 복원되리란 보장은 없어. 중요한 상태는 URL 파라미터나 `localStorage` 같은 다른 저장소를 같이 활용하는 게 현명해. "계란은 한 바구니에 담지 말랬지?"