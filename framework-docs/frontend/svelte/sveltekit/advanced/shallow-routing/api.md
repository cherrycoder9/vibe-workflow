**API**

`pushState` 쓸 때 첫 번째로 던져주는 건 URL인데, 지금 보고 있는 URL 기준으로 상대 경로를 적어주면 돼. 만약 URL은 그대로 두고 싶으면 빈 문자열(`''`)을 넣어. "야, 주소는 그대로 두고 내용만 바꿔!" 뭐 이런 거지.

두 번째로는 새 페이지 상태 값을 넣어주는데, 이건 나중에 `page` 객체 통해서 `page.state`로 꺼내 쓸 수 있어. 이 상태 값에 타입을 매겨서 안전하게 쓰고 싶으면 `App.PageState` 인터페이스 (보통 `src/app.d.ts` 파일에 만들지)를 선언해서 쓰면 돼. 타입스크립트 쓰는 이유가 뭐겠냐, 이런 거 하려고 쓰는 거지. "AnyScript는 이제 그만!"

만약 브라우저 방문 기록에 새 한 줄 추가 안 하고 페이지만 살짝 바꾸고 싶으면, `pushState` 대신 `replaceState`를 쓰면 된다. "나 여기 안 왔던 걸로 해줘" 같은 느낌으로 현재 히스토리 항목을 대체하는 거야.

참고로, `$app/state`에서 `page.state` 가져오는 건 스벨트킷 2.12 버전부터 추가된 기능이야. 그 이전 버전을 쓰거나 스벨트 4를 쓰고 있다면, `$app/stores`에서 `$page.state`를 가져와야 하니 헷갈리지 마라. "옛날 버전 쓰면서 최신 기능 왜 안되냐고 징징대지 말자."

---

**얘 뭐 하는 애냐?**
`pushState`랑 `replaceState`는 브라우저의 주소창(URL)을 새로고침 없이 샥 바꾸고, 페이지 상태 정보도 슬쩍 끼워 넣는 녀석들이야. SPA(싱글 페이지 애플리케이션)에서 "페이지 이동한 척" 할 때 쓰는 핵심 기술이지. 사용자는 페이지가 바뀐 줄 알지만, 사실은 한 페이지 안에서 DOM만 갈아끼우는 마술쇼!

**왜 쓰는데?**
1.  **매끄러운 사용자 경험:** 페이지 전체를 다시 로딩 안 하니까 빠릿빠릿하게 느껴짐. "새로고침? 그게 뭐죠? 먹는 건가요?"
2.  **URL에 상태 저장:** 필터링, 정렬, 현재 탭 같은 상태를 URL에 담아둘 수 있어서, 링크 공유하거나 북마크해도 그 상태 그대로 보여줄 수 있음. "야, 이 필터 먹인 결과 좀 봐봐!" (URL 복붙)
3.  **브라우저 뒤로 가기/앞으로 가기 지원:** 사용자가 무심코 누르는 뒤로 가기 버튼도 제대로 작동하게 만들어줌. 안 그러면 SPA는 뒤로 가기 누르면 이전 사이트로 튕겨 나가는 대참사가...

**언제 불려 나오냐?**
주로 사용자 인터랙션으로 페이지 내용이 바뀌어야 할 때, 예를 들어 탭 메뉴 클릭, 검색 필터 적용, "더 보기" 눌러서 내용 추가될 때 등등. 서버에 데이터 요청 없이 클라이언트에서 화면 전환할 때 호출돼.

**쓸 때 꿀팁 및 주의사항:**
*   **`pushState` vs `replaceState`:** `pushState`는 히스토리 한 줄 추가, `replaceState`는 현재 히스토리 덮어쓰기. 자잘한 상태 변경은 `replaceState`로 히스토리 깔끔하게 관리하는 게 좋음. "뒤로 가기 눌렀는데 방금 체크한 박스 하나 때문에 페이지 이동하면 킹받잖아."
*   **상태 객체는 가볍게:** `page.state`에 너무 무거운 데이터 넣으면 브라우저가 힘들어함. 꼭 필요한 최소한의 식별자나 간단한 정보만 넣자. "메모리 터지면 니 탓이다."
*   **`App.PageState`로 타입 정의:** 타입스크립트 쓴다면 `App.PageState` 인터페이스 정의해서 `page.state`를 타입 안전하게 쓰는 게 국룰. "any 스크립트 할 거면 타입스크립트 왜 쓰냐."
*   **버전 체크 필수:** `$app/state`에서 `page.state` 가져오는 건 스벨트킷 2.12부터! 구버전이면 `$app/stores`에서 가져와야 하니, "내 프로젝트 버전부터 확인하고 코드 짜라, 제발."
*   **`popstate` 이벤트:** 뒤로/앞으로 가기 버튼 누르면 `popstate` 이벤트 터지는데, 이때 `event.state` 받아서 페이지 내용 복원하는 로직도 잘 짜야 함. 안 그러면 URL만 바뀌고 화면은 그대로인 수가 있다. "어? 왜 화면이 안 바뀌지? 아..."