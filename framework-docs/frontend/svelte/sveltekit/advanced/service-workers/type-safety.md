**Type safety**

서비스 워커에서 타입을 제대로 설정하려면 몇 가지 수동 작업이 필요해. `service-worker.js` 파일 맨 위에 다음 코드를 때려 박아봐.

```javascript
/// <reference types="@sveltejs/kit" />
/// <reference no-default-lib="true"/>
/// <reference lib="esnext" />
/// <reference lib="webworker" />

const sw = /** @type {ServiceWorkerGlobalScope} */ (/** @type {unknown} */ (self));
```

타입스크립트를 쓴다면 이렇게:

```typescript
/// <reference types="@sveltejs/kit" />
/// <reference no-default-lib="true"/>
/// <reference lib="esnext" />
/// <reference lib="webworker" />

const sw = self as unknown as ServiceWorkerGlobalScope;
```

이렇게 하면 서비스 워커에서는 쓸 수 없는 `HTMLElement` 같은 DOM 타입에 접근하는 걸 막아주고, 올바른 전역 변수들을 쓸 수 있게 돼. `self`를 `sw`로 다시 할당하는 건 그 과정에서 타입 캐스팅(형변환)을 하기 위해서야. (다른 방법도 있지만, 이게 추가 파일 없이 제일 쉬운 방법). 파일 나머지 부분에서는 `self` 대신 `sw`를 써. 스벨트킷 타입 참조(`/// <reference types="@sveltejs/kit" />`)는 `$service-worker` 임포트가 올바른 타입 정의를 갖도록 보장해줘. 만약 `$env/static/public`을 임포트한다면, 임포트 구문에 `// @ts-ignore` 주석을 달거나, 참조 타입에 `/// <reference types="../.svelte-kit/ambient.d.ts" />`를 추가해야 해.

---

**얘 뭐 하는 애냐?**
한마디로 서비스 워커 파일 안에서 타입스크립트가 정신 차리고 제대로 돌아가게끔 환경 설정해주는 거야. 서비스 워커는 우리가 아는 일반적인 웹페이지(DOM)랑은 다른 동네에서 놀거든. 그래서 타입스크립트한테 "야, 여긴 니가 알던 동네(DOM) 아니고, 서비스 워커라는 신세계야! 여기 규칙을 따라!" 하고 알려주는 거지. 이렇게 하면 코드 짤 때 자동완성도 잘 되고, 엉뚱한 거 쓰려고 하면 "야, 그거 여기선 못 써!" 하고 미리 태클 걸어줘서 버그를 줄여주는 효과가 있어. "타입스크립트 잔소리꾼, 서비스 워커에도 출장 보낸 격."

**왜 쓰는데?**
1.  **개발 능률 UP:** 타입이 딱딱 맞으니까 자동완성 기능이 빵빵하게 터지고, 오타나 잘못된 API 사용 같은 실수를 줄여줘. "코딩하다 말고 '이거 맞나?' 검색하는 시간 절약."
2.  **버그 사전 차단:** 서비스 워커 환경에 없는 DOM API (예: `document.getElementById`) 같은 거 쓰려고 하면 컴파일할 때 바로 "님, 그거 안됨!" 하고 알려줘. 런타임에 에러 터져서 사용자가 "이 사이트 왜 이래?" 하기 전에 막는 거지. "미래의 나에게 욕먹을 일 사전 방지."
3.  **코드 이해도 & 유지보수 용이성 증가:** 타입이 명시되어 있으니 나중에 네가 다시 보거나 다른 사람이 네 코드를 볼 때 "아, 이 변수는 이런 타입이고, 저 함수는 저런 걸 반환하는구나" 하고 이해하기 훨씬 쉬워. "내가 짠 코드지만 내가 못 알아보는 불상사 방지."
4.  **스벨트킷 전용 기능 타입 지원:** `$service-worker`나 `$env/static/public` 같은 스벨트킷이 제공하는 편리한 기능들을 쓸 때, 타입스크립트의 든든한 지원사격을 받으려면 이 설정이 필수야.

**언제 불려 나오냐? (언제 설정하냐?)**
스벨트킷 프로젝트에서 서비스 워커를 쓸 때, 그 서비스 워커 파일 (`src/service-worker.js` 또는 `src/service-worker.ts`) 맨 윗부분에 이 설정들을 적어줘야 해. 특히 `self` 객체의 타입을 명확히 해서 서비스 워커 전용 API들 (예: `event.waitUntil()`, `clients.claim()`, 캐시 API 등)을 타입스크립트의 도움을 받으며 안전하게 쓰고 싶을 때 반드시 필요해.

**쓸 때 꿀팁 및 주의사항:**
*   **시키는 대로 복붙이 진리:** 저 `/// <reference ... />` 삼형제랑 `sw` 변수 할당 코드는 거의 "국룰"이니까, 일단 파일 맨 위에 복붙하고 시작하는 게 정신 건강에 이롭다. "고민할 시간에 코드 한 줄 더 짜자."
*   **`sw` 변수 사용을 생활화:** `self` 대신 타입 캐스팅한 `sw` 변수를 써야 타입스크립트의 참견과 도움을 제대로 받을 수 있어. 안 그러면 타입스크립트는 여전히 `self`를 일반 워커 `self`로 오해해서 반쪽짜리 지원만 해줄 수 있음. "이름표 바꿔줬으면 바뀐 이름으로 불러주는 게 인지상정."
*   **DOM API 접근 시도 = 에러 예약:** 다시 말하지만, 서비스 워커는 HTML 요소 같은 DOM에 직접 접근 못 한다. 이 타입 설정은 그런 시도를 막아주는 역할도 하니, 만약 DOM API 쓰려고 할 때 에러 나면 "아, 내가 서비스 워커에서 뻘짓했구나" 하고 깨달으면 됨.
*   **`$env/static/public` 임포트 시 대처법:** 환경 변수 쓸 때 타입 에러 나면, 설명대로 임포트 라인 위에 `// @ts-ignore` (일단 눈감아!) 쓰거나, `/// <reference types="../.svelte-kit/ambient.d.ts" />` (얘도 참고해!)를 추가해줘야 타입스크립트가 진정함.
*   **스벨트킷 업데이트 확인:** 스벨트킷 버전이 올라가면서 권장하는 설정 방식이 미묘하게 바뀔 수도 있으니, 가끔 공식 문서 한번 쓱 훑어보는 게 좋아. "어제의 꿀팁이 오늘의 삽질이 될 수도 있다."