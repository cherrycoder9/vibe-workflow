**Snapshots**

페이지 이동할 때 스크롤 위치나 `<input>`에 입력한 내용 같은, 그런 일시적인 DOM 상태는 그냥 휙 날아가 버려. 예를 들어 사용자가 폼 열심히 채우다가 제출 전에 딴 데 갔다 오거나, 페이지 새로고침 해버리면? 응, 다 지워져. 그런 입력값을 꼭 살려야겠다 싶을 때 쓰는 게 바로 이 DOM 상태 "스냅샷" 기능이야. 사용자가 다시 돌아오면 복구할 수 있게 해주지.

이걸 쓰려면, `+page.svelte`나 `+layout.svelte` 파일에서 `snapshot`이라는 객체를 만들고, 그 안에 `capture`랑 `restore` 메서드를 정의해서 내보내면 돼.

```svelte
// +page.svelte 예시

<script lang="ts">
	import type { Snapshot } from './$types';

	let comment = $state(''); // Svelte 5 $state 사용 예시 (원문엔 없지만 최신 스타일 반영)

	export const snapshot: Snapshot<string> = {
		capture: () => comment, // 페이지 떠날 때 comment 내용 캡처!
		restore: (value) => comment = value // 페이지 돌아오면 캡처했던 값으로 복원!
	};
</script>

<form method="POST">
	<label for="comment">댓글</label>
	<textarea id="comment" bind:value={comment} />
	<button>댓글 달기</button>
</form>
```

이 페이지에서 다른 곳으로 이동할 때, 페이지가 업데이트되기 직전에 `capture` 함수가 호출되고, 여기서 반환된 값은 브라우저 방문 기록의 현재 항목이랑 연결돼. 만약 다시 이 페이지로 돌아오면, 페이지가 업데이트되자마자 저장해뒀던 값과 함께 `restore` 함수가 호출되는 거지.

이 데이터는 `sessionStorage`에 저장될 수 있도록 JSON으로 변환 가능해야 해. 그래야 페이지를 새로고침하거나, 아예 다른 사이트 갔다가 돌아와도 상태를 복구할 수 있거든.

`capture` 함수에서 너무 큰 객체를 반환하는 건 피해야 해. 일단 캡처된 객체는 세션이 끝날 때까지 메모리에 계속 남아있고, 진짜 극단적인 경우엔 `sessionStorage`에 저장하기엔 너무 커서 문제가 생길 수도 있어.

---

**얘 뭐 하는 애냐?**
"야, 너 방금까지 하던 거 내가 잠깐 사진 찍어놨다!" 이거야. 사용자가 페이지를 떠났다가 다시 돌아왔을 때, 입력했던 폼 내용이나 스크롤 위치 같은 자잘한 상태들을 "짜잔~"하고 복원시켜주는 마법 같은 녀석이지. 실수로 뒤로 가기 눌렀다가 "아 내 글!!!" 하고 절규하는 상황을 막아주는 고마운 기능이라고.

**왜 쓰는데?**
1.  **사용자 빡침 방지:** 긴 글 쓰거나 복잡한 필터 설정했는데 새로고침 한 방에 날아가면 키보드 부수고 싶잖아. 그거 막아줘서 사용자의 정신 건강을 지켜준다.
2.  **작업 흐름 유지:** 스크롤 한참 내려서 보던 거, 여러 단계로 된 폼 작성하던 거, 그런 자잘한 상태를 기억해줘서 사용자가 딴짓하고 돌아와도 하던 작업 바로 이어서 할 수 있게 도와줘. "어디까지 했더라?" 고민할 필요 없지.
3.  **"깜빡이" 사용자 구제:** "어? 내가 뭘 누른 거지?" 하면서 페이지 막 이동하는 사용자들 있잖아. 그런 사용자들이 실수로 데이터 날려 먹는 걸 방지해줘.

**언제 불려 나오냐?**
*   `capture()`: 사용자가 현재 페이지에서 다른 페이지로 이동하려고 할 때, 또는 브라우저 탭을 닫거나 새로고침 하기 직전에 "잠깐! 이거 저장하고 가!" 하면서 호출돼.
*   `restore()`: 사용자가 뒤로 가기 버튼을 누르거나, 닫았던 탭을 다시 열거나, 새로고침 해서 아까 그 페이지로 돌아왔을 때, "자, 아까 찍어둔 사진 여기 있다!" 하면서 저장된 값으로 호출돼.

**쓸 때 꿀팁 및 주의사항:**
*   **JSON으로 변환 가능한 것만!:** `Date` 객체, 함수, `Map`, `Set` 같은 복잡한 놈들은 JSON으로 바로 못 바꿔. 문자열이나 숫자로 알아서 잘 변환해서 저장해야 돼. "김치냉장고에 피자 넣으면 안 되잖아? 규격에 맞는 것만 넣어라."
*   **`sessionStorage`의 한계:** 브라우저 탭 닫으면 `sessionStorage` 내용도 같이 사라져. 영구 보존은 아니라는 거. "퇴근하면 나도 간다." 진짜 중요한 데이터는 서버에 보내야지.
*   **용량 생각 좀 하고:** `sessionStorage`는 용량이 꽤 작아 (보통 5MB 정도). 이미지 데이터나 비디오 파일 주소 같은 거 통째로 넣으면 바로 터진다. "작은 가방에 코끼리 넣으려고 하지 마라." 꼭 필요한 최소한의 정보만 저장하는 게 국룰.
*   **민감 정보는 절대 금지:** 비밀번호, API 키 같은 거 여기다 저장하면 "우리 집 현관문 활짝 열어놓고 외출하는 격"이야. `sessionStorage`는 클라이언트에 저장돼서 보안에 취약하니까 절대 안 돼.
*   **모든 걸 스냅샷으로 해결하려 들지 마:** 이건 어디까지나 "일시적인" 상태를 위한 거야. 장바구니처럼 중요한 정보는 사용자가 로그인하면 서버에 저장하고 불러오는 게 정석이지. "스냅샷은 메모지, 서버는 금고다."
*   **`+layout.svelte`에서도 활용 가능:** 페이지 전체에 걸쳐 유지하고 싶은 상태, 예를 들어 다크 모드 설정이나 사이드바 메뉴 열림 상태 같은 건 레이아웃 레벨에서 스냅샷으로 관리하면 편해.