**Focus management (포커스 관리)**

옛날 방식의 서버 렌더링 웹사이트에서는 페이지 이동할 때마다 포커스(키보드 입력이나 스크린 리더가 현재 가리키는 위치)가 페이지 맨 위로 초기화됐어. 그래서 키보드나 스크린 리더 사용자들이 항상 페이지 처음부터 내용을 확인할 수 있었지.

스벨트킷은 클라이언트 사이드 라우팅(페이지 새로고침 없이 내용만 바꾸는 방식)을 쓰니까, 이런 동작을 흉내 내기 위해 페이지 이동이나 폼 제출이 끝나면 `<body>` 요소에 포커스를 맞춰줘. 딱 한 가지 예외가 있는데, 만약 페이지 안에 `autofocus` 속성이 붙은 놈이 있으면 그놈한테 대신 포커스를 줘. 그러니까 `autofocus` 쓸 때는 이게 보조 기술 사용자들한테 어떤 영향을 줄지 잘 생각해야 해. "함부로 `autofocus` 남발하다간 사용자 길 잃는다."

스벨트킷의 포커스 관리를 네 입맛대로 바꾸고 싶으면, `afterNavigate` 훅을 쓰면 돼:

```javascript
import { afterNavigate } from '$app/navigation';

afterNavigate(() => {
	/** @type {HTMLElement | null} */
	const to_focus = document.querySelector('.focus-me'); // '.focus-me' 클래스 가진 놈 찾아봐
	to_focus?.focus(); // 찾았으면 걔한테 포커스 줘
});
```

`goto` 함수를 써서 프로그래밍 방식으로 다른 페이지로 이동시킬 수도 있는데, 기본적으로는 링크 클릭했을 때랑 똑같이 작동해. 하지만 `goto` 함수에는 `keepFocus`라는 옵션이 있어서, 이걸 쓰면 포커스를 초기화하는 대신 현재 포커스된 요소를 그대로 유지시켜줘. 만약 이 옵션을 쓴다면, 페이지 이동 후에도 그 포커스된 요소가 반드시 화면에 남아있어야 해. 안 그러면 사용자는 포커스를 잃어버려서, 특히 보조 기술 사용자들한테는 "어? 나 어디 갔지?" 하는 혼란스러운 경험을 주게 될 거야.

---

**얘 뭐 하는 애냐?**
"Focus management"는 페이지가 바뀌거나 내용이 업데이트될 때, 키보드나 스크린 리더 사용자가 다음에 어디서부터 웹페이지랑 상호작용해야 할지 알려주는 길잡이 같은 거야. 클라이언트 사이드 라우팅 환경에서는 화면이 휙휙 바뀌어도 브라우저가 "자, 이제 여기서부터 시작!"하고 알려주지 않으니까, 프레임워크가 이 역할을 대신 해주는 거지. "새로운 스테이지 시작! 커서는 여기에 있습니다!" 같은 느낌.

**왜 쓰는데?**
1.  **웹 접근성 확보의 핵심:** 키보드만으로 웹을 탐색하거나 스크린 리더를 쓰는 사람들에게는 포커스 위치가 곧 '현재 위치'야. 이게 엉망이면 웹사이트 사용 자체가 불가능해질 수도 있어. "포커스는 생명선이다."
2.  **예측 가능한 사용자 경험:** 페이지 이동 후에 포커스가 예상 가능한 곳(보통 페이지 상단 또는 특정 입력 필드)으로 가면 사용자가 덜 헷갈려.
3.  **생산성 향상 (특정 경우):** 예를 들어, 폼을 여러 단계에 걸쳐 작성할 때 다음 단계로 넘어가도 특정 입력 필드에 포커스가 유지되면 사용자가 바로 입력을 이어갈 수 있어서 편하겠지. (물론 `keepFocus` 옵션은 신중하게 써야 하지만)

**언제 불려 나오냐?**
*   스벨트킷에서 페이지 이동 (링크 클릭, `goto` 함수 호출 등)이 발생한 직후.
*   스벨트킷의 향상된 폼(enhanced form) 제출이 완료된 직후.
*   개발자가 `afterNavigate` 훅을 사용해서 특정 요소에 직접 포커스를 주도록 코드를 짰을 때.

**쓸 때 꿀팁 및 주의사항:**
*   **`autofocus`는 신중하게:** 페이지 로드되자마자 특정 요소에 자동으로 포커스를 주는 건 편리할 수 있지만, 스크린 리더 사용자는 페이지 상단부터 순차적으로 내용을 읽고 싶어 할 수 있어. `autofocus` 때문에 갑자기 페이지 중간으로 포커스가 튀면 맥락을 놓칠 수 있으니, "이거 진짜 사용자한테 도움 되는 거 맞나?" 두 번, 세 번 고민하고 써.
*   **`afterNavigate`로 커스텀할 때:** 특정 요소로 포커스를 옮길 거면, 그 요소가 사용자에게 가장 중요하거나 다음 행동을 유도하는 곳이어야 해. 예를 들어, 검색 결과 페이지로 이동했다면 검색창보다는 결과 목록의 첫 번째 항목에 포커스를 주는 게 더 자연스러울 수 있지. "사용자가 뭘 하고 싶어 할지 꿰뚫어 봐라."
*   **`goto`의 `keepFocus: true`는 양날의 검:** 현재 포커스된 요소가 다음 페이지에도 그대로 존재하고, 그 위치에 계속 포커스가 있는 게 합리적일 때만 써야 해. 만약 그 요소가 사라지면 사용자는 포커스를 잃고 허공에 삽질하게 돼. "사라진 첫사랑 찾듯 포커스 찾아 헤매게 만들지 마라."
*   **모달(Modal)이나 팝업 처리:** 모달 창이 뜰 때는 포커스가 모달 안으로 옮겨가고, 닫힐 때는 원래 있던 곳으로 돌아오도록 잘 관리해야 해. 이건 스벨트킷 기본 동작 외에 추가적인 처리가 필요할 수 있어. "모달은 가상 감옥, 포커스 탈출은 금지!"
*   **항상 테스트, 또 테스트:** 특히 키보드만으로 네 웹사이트를 처음부터 끝까지 사용해보고, 가능하다면 스크린 리더로도 테스트해봐. 개발자 도구에서 보이는 거랑 실제 사용 경험은 천지 차이일 수 있어. "네 눈만 믿지 말고, 사용자의 손과 귀를 믿어라."