CDN에서 동적으로 이미지 불러오기

가끔 이미지가 빌드 시점에는 접근 불가능한 경우가 있어. 예를 들어 CMS(콘텐츠 관리 시스템) 안에 있거나 다른 어딘가에 처박혀 있을 수 있다는 거지.

이럴 때 CDN(콘텐츠 전송 네트워크)을 쓰면 이미지를 동적으로 최적화할 수 있고, 사이즈 조절 같은 것도 훨씬 유연하게 할 수 있어. 물론 초기 설정이 좀 귀찮고 사용료가 나갈 수도 있다는 단점은 감안해야 해. 캐싱 전략에 따라서는 CDN에서 304 응답을 받기 전까지 브라우저가 캐시된 이미지를 못 쓸 수도 있고. CDN을 쓰면 `<img>` 태그만으로도 CDN이 알아서 User-Agent 헤더 보고 적절한 포맷으로 이미지를 내려주지만, 빌드 시점에 최적화하려면 `<picture>` 태그에 여러 소스를 명시해야 하는 번거로움이 있지. 마지막으로, 어떤 CDN은 이미지를 게으르게(lazily) 생성하는데, 이건 트래픽 적고 이미지가 자주 바뀌는 사이트에서는 오히려 성능에 안 좋을 수 있어. "손님도 없는데 맨날 메뉴판 새로 쓰는 식당" 같은 거지.

CDN은 보통 라이브러리 없이도 쓸 수 있지만, Svelte를 지원하는 몇몇 라이브러리를 쓰면 훨씬 편해. `@unpic/svelte`는 여러 CDN 업체를 지원하는 범용 라이브러리고, Cloudinary 같은 특정 CDN 업체가 Svelte 지원 기능을 제공하기도 해. Contentful, Storyblok, Contentstack처럼 Svelte를 지원하는 CMS 중에는 자체적으로 이미지 처리 기능을 내장한 경우도 있으니 참고하고.

---

**얘 뭐 하는 애냐?**
빌드할 때 이미지 다 쑤셔 넣는 거 말고, 사용자가 페이지 볼 때 CDN에서 실시간으로 최적화된 이미지를 땡겨오는 기술이야. 원본 이미지는 어딘가에 짱박아두고, CDN이 알아서 사용자 환경에 맞게 사이즈 줄이고 포맷 바꿔서 보여주는 거지. "이미지계의 똑똑한 심부름꾼"이라고나 할까.

**왜 쓰는데?**
1.  **빌드 시간 단축:** 이미지 많아도 빌드 가볍게 끝. "빌드가 뭐죠? 빛의 속도로 끝났는데."
2.  **자동 최적화:** 사용자 기기, 화면 크기, 네트워크 상태에 맞춰 CDN이 알아서 최적 이미지 제공. 개발자는 발 뻗고 자도 됨.
3.  **유연성 갑:** CMS 같은 외부 시스템에 이미지 있어도 OK. 다양한 사이즈 이미지 즉석에서 생성 가능.
4.  **서버 부하 감소:** 이미지 요청은 CDN이 다 받아주니 우리 서버는 편안~.

**물론 단점도 있지:**
*   **셋업 & 비용:** CDN 설정 좀 만져줘야 하고, 트래픽 많으면 돈 나감. "세상에 공짜는 없다."
*   **캐싱 복잡성:** 캐싱 전략 잘못 짜면 사용자한테 옛날 이미지 보여주거나, CDN이 매번 새로 이미지 만드느라 바쁨.
*   **저 트래픽 사이트의 함정:** 이미지 자주 바뀌는데 방문자 적으면, CDN이 매번 이미지 새로 만드느라 오히려 느려질 수 있음. "손님보다 직원이 더 바쁜 가게."

**언제 불려 나오냐?**
*   빌드 시점에 이미지가 어디 있는지 모르거나, 접근하기 까다로울 때.
*   다양한 해상도와 포맷의 이미지를 동적으로 제공하고 싶을 때.
*   이미지 최적화는 CDN한테 맡기고 싶을 때. "전문가에게 맡기세요."

**쓸 때 꿀팁 및 주의사항:**
*   **CDN 선택은 신중하게:** 가격, 성능, 기능, 지원하는 최적화 옵션 등 따져볼 게 많다. "아무거나 쓰면 피눈물 흘린다."
*   **캐싱 전략이 생명:** 브라우저 캐시와 CDN 캐시를 잘 조율해야 비용도 아끼고 성능도 잡는다. `Cache-Control` 헤더, `ETag` 등을 잘 활용하자.
*   **`<img>` 태그로 심플하게:** CDN이 `User-Agent` 보고 알아서 WebP 같은 최신 포맷으로 바꿔주니, 웬만하면 `<img>` 태그 하나로 충분. `<picture>` 태그의 복잡함에서 해방될 수 있다. (물론 아트 디렉션 같은 세밀한 제어가 필요하면 `<picture>` 써야지.)
*   **지연 로딩(Lazy Loading)은 기본, 지연 생성(Lazy Generation)은 주의:** 화면에 보이는 이미지만 로딩하는 건 좋은데, CDN이 요청 올 때마다 이미지 새로 만드는 방식(지연 생성)은 트래픽 적은 사이트에선 비효율적일 수 있다.
*   **라이브러리 활용:** `@unpic/svelte` 같은 라이브러리는 여러 CDN을 쉽게 바꿔 쓰거나, 이미지 URL 생성을 편하게 해준다. CMS 자체 기능도 적극 활용하자. "좋은 연장이 일 반은 한다."