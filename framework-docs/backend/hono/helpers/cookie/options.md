알겠다. 쿠키 관련 함수들, `setCookie`, `setSignedCookie`, `deleteCookie`에 대해 핵심만 콕콕 짚어주지.

---

**`setCookie` & `setSignedCookie` (쿠키 굽기 & 비밀 쿠키 굽기)**

얘네는 클라이언트(브라우저)에 "야, 이 정보 좀 기억하고 있어!" 하고 쿠키라는 작은 쪽지를 구워서 보내는 녀석들이야. `setCookie`는 그냥 일반 쿠키, `setSignedCookie`는 "이거 누가 중간에 건드리면 바로 티 난다!" 하고 서명을 딱 박은 비밀 쿠키를 만들지.

**옵션들 (쿠키 레시피 재료)**

*   `domain: string`: "이 쿠키는 example.com 이랑 그 하위 도메인에서만 써!" 하고 쿠키의 활동 범위를 정해주는 거야. 안 쓰면 현재 도메인만.
*   `expires: Date`: "이 쿠키는 2000년 12월 24일 10시 30분 59초 900밀리초(UTC 기준)까지만 유효해!" 하고 쿠키의 유통기한(절대 시간)을 정해. 이 시간 지나면 쿠키는 자동으로 사라짐.
*   `httpOnly: boolean`: `true`로 하면 "자바스크립트 따위가 감히 내 쿠키를 넘봐? 어림없지!" 하고 클라이언트 쪽 스크립트가 쿠키에 접근 못하게 막아. XSS 공격 방어에 도움 됨. (중요!)
*   `maxAge: number`: "지금부터 1000초 동안만 살아있어!" 하고 쿠키의 수명(상대 시간, 초 단위)을 정해. `expires`랑 비슷하지만 이게 더 쓰기 편할 때도 있어. 둘 다 쓰면 `maxAge`가 우선될 수 있음 (브라우저마다 다를 수 있으니 주의).
*   `path: string`: "이 쿠키는 우리 웹사이트의 `/` 경로 밑에서만 유효해!" 하고 쿠키가 작동하는 경로를 지정. `/admin`으로 하면 `/admin` 밑에서만 쿠키가 전송됨.
*   `secure: boolean`: `true`로 하면 "HTTPS 연결일 때만 이 쿠키를 보내! HTTP는 위험해!" 하고 보안 연결에서만 쿠키를 전송하도록 강제. (중요!)
*   `sameSite: 'Strict' | 'Lax' | 'None'`: CSRF 공격 방어의 핵심!
    *   `'Strict'`: "같은 사이트에서 요청 보낼 때만 쿠키 줄 거야! 다른 사이트에서 우리 사이트로 링크 타고 오는 건 안 줘!" 제일 빡셈.
    *   `'Lax'`: (보통 기본값) "다른 사이트에서 우리 사이트로 GET 요청(링크 클릭, 주소창 입력 등)으로 올 때는 쿠키 줄게. 근데 POST, PUT 같은 건 안 돼!" 적당히 타협.
    *   `'None'`: "아무나 다 가져가! 단, `secure: true`랑 같이 써야 돼!" 외부 사이트에 iframe으로 삽입되거나 할 때 필요. `secure` 옵션 없이는 최신 브라우저에서 거부당함.
*   `priority: 'Low' | 'Medium' | 'High'`: "이 쿠키는 좀 중요하니까 빨리 처리해줘!" 하고 브라우저에게 쿠키의 중요도를 알려주는 기능. 아직 모든 브라우저가 지원하는 건 아님.
*   `prefix: 'secure' | 'host'`: 쿠키 이름 앞에 자동으로 특정 접두사를 붙여서 보안을 강화하는 방법.
    *   `__Secure-`: `secure: true`가 강제됨.
    *   `__Host-`: `secure: true`, `domain` 미지정 (현재 호스트만), `path: '/'`가 강제됨. 더 빡셈.
*   `partitioned: boolean`: 서드파티 쿠키가 막히는 추세에 대응하기 위해 나온 옵션. `true`로 하고 `sameSite: 'None'`과 함께 쓰면, 최상위 사이트별로 쿠키를 분리해서 저장. (복잡하니 필요할 때 자세히 파봐)

**예시 (이렇게 구워봐!)**

```typescript
// 일반 쿠키: 바나나맛 쿠키, example.com 루트 경로에서만, HTTPS로만, JS 접근 금지, 1000초 동안, 2000년 크리스마스 이브에 만료, 같은 사이트에서만!
setCookie(c, 'great_cookie', 'banana', {
  path: '/',
  secure: true,
  domain: 'example.com',
  httpOnly: true,
  maxAge: 1000,
  expires: new Date(Date.UTC(2000, 11, 24, 10, 30, 59, 900)), // 달력 똑바로 봐라, 11이 12월이다!
  sameSite: 'Strict',
})

// 서명된 쿠키: 포춘 쿠키, 내용은 "돈벼락", 비밀 재료는 "secret ingredient", 옵션은 위와 동일!
// await 키워드 붙는 거 보니 비동기로 돌아가나 보네? 서명하는 데 시간이 좀 걸리나?
await setSignedCookie(
  c,
  'fortune_cookie',
  'lots-of-money',
  'secret ingredient', // 이 비밀키는 서버만 알고 있어야 해!
  {
    path: '/',
    secure: true,
    domain: 'example.com',
    httpOnly: true,
    maxAge: 1000,
    expires: new Date(Date.UTC(2000, 11, 24, 10, 30, 59, 900)),
    sameSite: 'Strict',
  }
)
```

---

**`deleteCookie` (쿠키 버리기)**

얘는 이름 그대로 "이 쿠키 이제 필요 없으니 갖다 버려!" 하고 클라이언트에게 쿠키 삭제를 요청하는 녀석이야. 사실 진짜 삭제라기보다는, 같은 이름의 쿠키를 과거 시간으로 만료시켜서 브라우저가 알아서 지우게 만드는 꼼수지.

**옵션 (어떤 쿠키를 버릴까?)**

*   `path: string`
*   `secure: boolean`
*   `domain: string`

**중요!** 쿠키를 지울 때는 쿠키를 **설정할 때 썼던 `path`, `domain`, `secure` 옵션을 똑같이 지정해줘야** 제대로 지워져. 하나라도 다르면 브라우저는 "어? 이거 내가 아는 그 쿠키 아닌데?" 하고 못 지움. "쓰레기 버릴 때도 분리수거 제대로 해야 수거해 간다!"

**예시 (이렇게 버려!)**

```typescript
// 바나나맛 쿠키, example.com 루트 경로, HTTPS로 설정된 거 지워줘!
deleteCookie(c, 'banana', {
  path: '/',
  secure: true,
  domain: 'example.com',
})

// deleteCookie는 삭제된 (혹은 삭제 시도한) 쿠키의 "값"을 반환하기도 해.
// 근데 보통 삭제 성공 여부보다는 그냥 "지워!" 하고 명령하는 용도로 쓰지.
const deletedCookie = deleteCookie(c, 'delicious_cookie')
```

---

**얘네 뭐 하는 애들이냐?**
`setCookie`와 `setSignedCookie`는 서버가 클라이언트(주로 웹 브라우저)에게 특정 정보를 기억하도록 지시하는 방법이야. "로그인했음", "장바구니에 이거 담았음", "다크 모드 사용 중" 같은 상태 정보를 저장하지. `deleteCookie`는 그 기억을 지우는 거고.

**왜 쓰는데?**
1.  **상태 유지 (로그인 세션 등)**: HTTP는 원래 상태가 없어(stateless). 그래서 사용자가 페이지 옮길 때마다 "님 누구셈?" 하고 새로 물어봐야 하는데, 쿠키에 로그인 정보 (세션 ID 같은 거)를 담아두면 "아, 이 손님 아까 그 손님이네!" 하고 알아볼 수 있어.
2.  **사용자 경험 개인화**: "다크 모드 선호", "언어 설정은 한국어" 같은 사용자 설정을 쿠키에 저장해두면 다음에 방문했을 때도 똑같이 보여줄 수 있지.
3.  **추적 및 분석 (조심해서 써야 함)**: 사용자가 어떤 페이지를 봤는지, 뭘 클릭했는지 같은 행동 패턴을 쿠키로 추적해서 마케팅이나 서비스 개선에 쓰기도 해. 근데 이건 개인정보보호 문제랑 직결되니까 법규 잘 지키고 사용자 동의도 받아야 함. "빅브라더는 되지 말자!"

**언제 불려 나오냐?**
*   `setCookie`/`setSignedCookie`:
    *   로그인 성공했을 때 "로그인 성공! 인증 토큰 쿠키에 박아줄게!"
    *   사용자가 환경 설정을 바꿨을 때 "다크 모드 설정 쿠키에 저장 완료!"
    *   장바구니에 물건 담았을 때 "이 상품 장바구니 쿠키에 킵!"
*   `deleteCookie`:
    *   로그아웃했을 때 "로그아웃 처리 완료! 인증 쿠키 삭제!"
    *   더 이상 필요 없는 설정 정보를 지울 때.

**쓸 때 꿀팁 및 주의사항:**
*   **`httpOnly`, `secure`, `sameSite`는 삼위일체 보안 옵션**: 웬만하면 다 켜. 특히 `httpOnly`는 XSS 공격 막는 데, `secure`는 중간자 공격 막는 데, `sameSite`는 CSRF 공격 막는 데 필수야. "보안은 아무리 강조해도 지나치지 않다."
*   **쿠키 크기 제한**: 브라우저마다 다르지만 쿠키 하나당 보통 4KB, 도메인당 쿠키 개수도 제한이 있어. 너무 많은 정보나 큰 데이터를 쿠키에 쑤셔 넣으려고 하지 마. "쿠키는 간식이지 주식이 아니다."
*   **민감 정보는 `setSignedCookie` 또는 서버 세션**: 비밀번호 같은 진짜 민감한 정보는 쿠키에 직접 저장하면 절대 안 돼! `setSignedCookie`는 변조 방지용이지 암호화가 아니야. 정 필요하면 암호화된 세션 ID만 쿠키에 저장하고, 실제 데이터는 서버에 안전하게 보관해야 해. "비밀번호를 쿠키에? 너 해고."
*   **`expires` vs `maxAge`**: `expires`는 특정 날짜/시간에 만료, `maxAge`는 지금부터 몇 초 후에 만료. 둘 다 지정하면 브라우저에 따라 `maxAge`가 우선될 수 있지만, 그냥 하나만 명확히 쓰는 게 덜 헷갈려. 세션 쿠키(브라우저 끄면 사라지는 쿠키) 만들고 싶으면 둘 다 설정 안 하면 됨.
*   **`deleteCookie` 할 때 옵션 일치! (두 번 강조)**: 설정할 때 `path: '/user'`, `domain: 'service.example.com'` 이렇게 했으면, 지울 때도 똑같이 해줘야 지워진다. 안 그러면 "왜 쿠키 안 지워지지?" 하고 삽질하게 됨.
*   **서명된 쿠키의 비밀키 관리**: `setSignedCookie` 쓸 때 들어가는 `secret ingredient` (비밀키)는 절대로 코드에 하드코딩하거나 외부에 노출되면 안 돼. 환경 변수로 빼서 안전하게 관리해야 함. 이 키 털리면 서명된 쿠키도 다 무용지물이야. "비밀번호는 엄마한테도 알려주면 안 된다."
*   **날짜는 UTC 기준으로**: `expires: new Date(Date.UTC(...))` 처럼 UTC 기준으로 날짜 객체를 만드는 게 좋아. 안 그러면 서버랑 클라이언트 시간대 차이 때문에 쿠키 만료 시간이 꼬일 수 있어. "시간은 소중하니까, 표준시로 통일!"